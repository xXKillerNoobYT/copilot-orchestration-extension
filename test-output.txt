
> copilot-orchestration-extension@0.0.1 test:once
> jest --coverage

  console.log
    [INFO] 2026-02-03T02:02:40.194Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.360Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.364Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.367Z Created ticket: TICKET-1770084160367

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.370Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.374Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.376Z Created ticket: TICKET-1770084160376

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.378Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.383Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.384Z Created ticket: TICKET-1770084160384

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.387Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.391Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.394Z Created ticket: TICKET-1770084160394

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.396Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.400Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.403Z Created ticket: TICKET-1770084160403

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.404Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.406Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.410Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.412Z Created ticket: TICKET-1770084160412

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.413Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.415Z Created ticket: TICKET-1770084160415

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.416Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.420Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

PASS tests/ui/agentsTreeProvider.test.ts
  AgentsTreeDataProvider (Dynamic Status)
    constructor
      Î“ÃªÃœ should subscribe to ticket changes on instantiation (9 ms)
      Î“ÃªÃœ should handle subscription errors gracefully (1 ms)
    getChildren with dynamic status
      Î“ÃªÃœ should return 4 agent items always (24 ms)
      Î“ÃªÃœ should display Idle when status is undefined (1 ms)
      Î“ÃªÃœ should display Active status with truncated result (38 ms)
      Î“ÃªÃœ should use spinning icon for Active agent (1 ms)
      Î“ÃªÃœ should use check icon for Waiting agent (2 ms)
      Î“ÃªÃœ should use error icon for Failed agent
      Î“ÃªÃœ should include timestamp in tooltip (1 ms)
      Î“ÃªÃœ should handle result truncation to 50 chars (1 ms)
      Î“ÃªÃœ should display all agents with different statuses (1 ms)
      Î“ÃªÃœ should not include "Last:" in description when no result
      Î“ÃªÃœ should display currentTask in description when available (1 ms)
      Î“ÃªÃœ should prioritize currentTask over lastResult in description (1 ms)
      Î“ÃªÃœ should truncate currentTask to 50 chars (1 ms)
      Î“ÃªÃœ should include currentTask in tooltip (1 ms)
      Î“ÃªÃœ should include both currentTask and lastResult in tooltip
      Î“ÃªÃœ should show "Idle" with no extra info when agent has no task or result (1 ms)
      Î“ÃªÃœ should handle Failed agent with error message in tooltip (1 ms)
    tree refresh on ticket change
      Î“ÃªÃœ should trigger refresh when listener called (1 ms)
      Î“ÃªÃœ should fire onDidChangeTreeData when refresh called
    real-time updates on agent status change
      Î“ÃªÃœ should subscribe to agentStatusTracker.onStatusChange on construction
      Î“ÃªÃœ should refresh tree when agent status changes (1 ms)
    getTreeItem
      Î“ÃªÃœ should return item unchanged
    getChildren with element
      Î“ÃªÃœ should return empty array for no children (1 ms)
    edge cases and comprehensive coverage
      Î“ÃªÃœ should handle agent with no timestamp gracefully (2 ms)
      Î“ÃªÃœ should show all 4 agents with different icons simultaneously (1 ms)
      Î“ÃªÃœ should handle very long currentTask and lastResult both present (2 ms)
      Î“ÃªÃœ should handle status change subscription error gracefully (1 ms)
      Î“ÃªÃœ should format timestamp correctly in tooltip (2 ms)
      Î“ÃªÃœ should handle empty string currentTask (1 ms)
      Î“ÃªÃœ should handle empty string lastResult (3 ms)

PASS tests/orchestrator.test.ts
  Orchestrator Service
    initialization
      Î“ÃªÃœ Test 1: should initialize with default timeout when config missing (19 ms)
      Î“ÃªÃœ Test 2: should read timeout from config.orchestrator.taskTimeoutSeconds (2 ms)
      Î“ÃªÃœ Test 3: should fallback to llm.timeoutSeconds if orchestrator config missing (3 ms)
    queue ordering (FIFO)
      Î“ÃªÃœ Test 4: should return tasks in FIFO order (5 ms)
      Î“ÃªÃœ Test 5: should return null when queue is empty
      Î“ÃªÃœ Test 6: should filter for open and in-progress tickets only
    timeout detection and blocking
      Î“ÃªÃœ Test 7: should create blocked ticket when task idle >30s (using fake timers) (10 ms)
      Î“ÃªÃœ Test 8: should not create duplicate blocked tickets for same task (2 ms)
    edge cases
      Î“ÃªÃœ Test 10: should handle TicketDb errors gracefully (1 ms)
      Î“ÃªÃœ Test 11: should throw error if getNextTask called before initialization (74 ms)
      Î“ÃªÃœ Test 12: should prevent duplicate initialization
    routeQuestionToAnswer
      Î“ÃªÃœ should call LLM with question and return response (1 ms)
      Î“ÃªÃœ should include Answer agent system prompt (1 ms)
      Î“ÃªÃœ should handle LLM failure and return fallback message (1 ms)
      Î“ÃªÃœ should not create duplicate ticket on LLM failure (1 ms)
      Î“ÃªÃœ should log question routing and response (1 ms)
    routeToPlanningAgent
      Î“ÃªÃœ should log chunks and accumulate full plan (2 ms)
      Î“ÃªÃœ should handle empty response gracefully (1 ms)
      Î“ÃªÃœ should truncate long plans in logs (1 ms)
    routeToVerificationAgent
      Î“ÃªÃœ should call completeLLM with verification system prompt (2 ms)
      Î“ÃªÃœ should parse PASS response and avoid ticket creation (1 ms)
      Î“ÃªÃœ should parse FAIL response and create blocked ticket (1 ms)
      Î“ÃªÃœ should default to FAIL on ambiguous response (1 ms)
      Î“ÃªÃœ should truncate long explanations in logs (1 ms)
      Î“ÃªÃœ should fail fast when code diff is empty (1 ms)
      Î“ÃªÃœ should handle LLM errors without creating duplicate tickets (1 ms)
    Planning Agent
      Î“ÃªÃœ should stream plan chunks to logs via callback (2 ms)
      Î“ÃªÃœ should handle empty plan response (1 ms)
      Î“ÃªÃœ should handle planning timeout by returning fallback message (1 ms)
    Answer Agent
      Î“ÃªÃœ should call completeLLM and log response (2 ms)
      Î“ÃªÃœ should create ticket when response contains "ticket" keyword (28 ms)
      Î“ÃªÃœ should create ticket when response contains "create" keyword (1 ms)
      Î“ÃªÃœ should not create ticket for normal response without action keywords (1 ms)
      Î“ÃªÃœ should warn and return early for empty question (1 ms)
      Î“ÃªÃœ should warn and return early for whitespace-only question (1 ms)
      Î“ÃªÃœ should truncate long response in logs (>500 chars) (1 ms)
      Î“ÃªÃœ should handle case-insensitive keyword detection (1 ms)
      Î“ÃªÃœ should handle completeLLM timeout error gracefully (1 ms)
      Î“ÃªÃœ should handle empty LLM response
      Î“ÃªÃœ should create ticket with truncated question in title

  console.log
    [INFO] 2026-02-03T02:02:40.727Z Ticket DB initialized: SQLite at C:\mock\extension\path\.coe\tickets.db

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.774Z Ticket DB initialized: SQLite at C:\mock\extension\path\.coe\tickets.db

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.777Z Created ticket: TICKET-1770084160775

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.778Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.855Z Ticket DB initialized: SQLite at C:\mock\extension\path\.coe\tickets.db

      at log (src/logger.ts:68:17)

PASS tests/ui/agentStatusTracker.test.ts
  AgentStatusTracker
    Singleton Instance
      Î“ÃªÃœ should return same instance on multiple calls (1 ms)
      Î“ÃªÃœ should initialize all agents to Idle status (1 ms)
    setAgentStatus
      Î“ÃªÃœ should set agent status to Active with result (1 ms)
      Î“ÃªÃœ should set agent status without result (undefined) (1 ms)
      Î“ÃªÃœ should update existing agent status (1 ms)
      Î“ÃªÃœ should set agent to Failed status with error message
      Î“ÃªÃœ should log agent status update
      Î“ÃªÃœ should truncate result in logs to 50 chars
      Î“ÃªÃœ should not include result in log if undefined (1 ms)
      Î“ÃªÃœ should handle empty string result
      Î“ÃªÃœ should update timestamp on each call (22 ms)
    getAgentStatus
      Î“ÃªÃœ should return agent status when it exists (1 ms)
      Î“ÃªÃœ should return undefined for non-existent agent
      Î“ÃªÃœ should return Idle status initially for all agents (1 ms)
      Î“ÃªÃœ should return same reference after multiple gets
    resetAll
      Î“ÃªÃœ should reset all agents to Idle status
      Î“ÃªÃœ should clear lastResult on reset
      Î“ÃªÃœ should log reset action (1 ms)
      Î“ÃªÃœ should reset only to Idle, not remove agents
      Î“ÃªÃœ should handle reset when agents already Idle
      Î“ÃªÃœ should reset multiple times independently (1 ms)
    getAllStatuses
      Î“ÃªÃœ should return map of all agent statuses (2 ms)
      Î“ÃªÃœ should return copy of internal map (not reference) (1 ms)
      Î“ÃªÃœ should include all four agents with initial Idle status (1 ms)
      Î“ÃªÃœ should include updated statuses after set operations (1 ms)
      Î“ÃªÃœ should include timestamp in all statuses after setAgentStatus
      Î“ÃªÃœ should reflect state after resetAll (1 ms)
    Complex Workflows
      Î“ÃªÃœ should handle planning workflow: Idle Î“Ã¥Ã† Active Î“Ã¥Ã† Waiting (1 ms)
      Î“ÃªÃœ should handle verification workflow: Idle Î“Ã¥Ã† Active Î“Ã¥Ã† Waiting with result (1 ms)
      Î“ÃªÃœ should handle error workflow: Idle Î“Ã¥Ã† Active Î“Ã¥Ã† Failed (1 ms)
      Î“ÃªÃœ should track multiple agents independently (1 ms)
    Edge Cases
      Î“ÃªÃœ should handle very long result strings
      Î“ÃªÃœ should handle special characters in result
      Î“ÃªÃœ should handle all valid status types
      Î“ÃªÃœ should handle rapid status updates (1 ms)
      Î“ÃªÃœ should handle getting status for all agent names (1 ms)
    currentTask field
      Î“ÃªÃœ should set currentTask via setAgentTask (1 ms)
      Î“ÃªÃœ should preserve currentTask when setAgentStatus is called without clearing it
      Î“ÃªÃœ should clear currentTask when set to undefined (1 ms)
      Î“ÃªÃœ should update timestamp when setting currentTask (23 ms)
      Î“ÃªÃœ should log currentTask changes (1 ms)
      Î“ÃªÃœ should truncate currentTask in logs to 50 chars (1 ms)
      Î“ÃªÃœ should handle setting task for non-existent agent gracefully
      Î“ÃªÃœ should clear currentTask on resetAll (1 ms)
    event emission
      Î“ÃªÃœ should expose onStatusChange event emitter
      Î“ÃªÃœ should fire event when setAgentStatus is called (1 ms)
      Î“ÃªÃœ should fire event when setAgentTask is called
      Î“ÃªÃœ should fire events for each agent on resetAll
      Î“ÃªÃœ should allow multiple listeners to subscribe (1 ms)
      Î“ÃªÃœ should not notify disposed listeners

  console.log
    [INFO] 2026-02-03T02:02:40.879Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.880Z Created ticket: TICKET-1770084160880

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.881Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.881Z Updated ticket: TICKET-1770084160880

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.882Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

PASS tests/agents/answerAgent.test.ts
  AnswerAgent
    createChatId
      Î“ÃªÃœ should generate unique chat IDs (31 ms)
      Î“ÃªÃœ should generate chat IDs with expected format
    AnswerAgent.ask() - Single Turn
      Î“ÃªÃœ should answer a question and return the response (9 ms)
      Î“ÃªÃœ should store question and answer in history after first ask (1 ms)
      Î“ÃªÃœ should generate new chatId if none provided (1 ms)
    AnswerAgent.ask() - Multi-Turn
      Î“ÃªÃœ should include previous Q&A in messages for follow-up (1 ms)
      Î“ÃªÃœ should maintain separate histories for different chatIds (1 ms)
      Î“ÃªÃœ should trim history to MAX_HISTORY_EXCHANGES when exceeded (2 ms)
      Î“ÃªÃœ should pass complete message history to LLM on each turn
    AnswerAgent.getHistory()
      Î“ÃªÃœ should return undefined for non-existent chatId
      Î“ÃªÃœ should return empty array equivalent (via getHistory) for new chatId (1 ms)
    AnswerAgent.clearHistory()
      Î“ÃªÃœ should remove history for specified chatId
      Î“ÃªÃœ should not affect other chatIds when clearing one (1 ms)
    AnswerAgent Error Handling
      Î“ÃªÃœ should handle LLM errors gracefully (34 ms)
      Î“ÃªÃœ should log error when LLM fails (2 ms)
    Message Format Validation
      Î“ÃªÃœ should send messages in correct OpenAI format (2 ms)
      Î“ÃªÃœ should always include system prompt as first message (1 ms)
    Edge Cases
      Î“ÃªÃœ should handle empty question string
      Î“ÃªÃœ should handle very long question text (1 ms)
      Î“ÃªÃœ should handle exactly MAX_HISTORY_EXCHANGES exchanges without trimming
    Auto-close inactive conversations
      Î“ÃªÃœ should close conversations inactive for >30 days (3 ms)
      Î“ÃªÃœ should NOT close conversations active within 30 days (2 ms)
      Î“ÃªÃœ should handle exactly 30 days (boundary condition) (1 ms)
      Î“ÃªÃœ should handle cleanup with no conversations (2 ms)
      Î“ÃªÃœ should handle multiple chats (old and new) (2 ms)
      Î“ÃªÃœ should handle cleanup errors gracefully (1 ms)
      Î“ÃªÃœ should update lastActivityAt on each ask (1 ms)
      Î“ÃªÃœ should log each deleted conversation with details (2 ms)

  console.log
    [INFO] 2026-02-03T02:02:40.927Z Ticket DB initialized: SQLite at C:\mock\extension\path\.coe\tickets.db

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.958Z Updated ticket: TEST-123

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.959Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.973Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.980Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.981Z Created ticket: TICKET-1770084160981

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.982Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.982Z Updated ticket: TICKET-1770084160981

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.983Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:40.893Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.014Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.016Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.error
    [ERROR] 2026-02-03T02:02:41.020Z Failed to subscribe to ticket changes: Error: Subscription failed

    [0m [90m 82 |[39m     [36mconst[39m line [33m=[39m [32m`[ERROR] ${new Date().toISOString()} ${msg}`[39m[33m;[39m
     [90m 83 |[39m     getOutputChannel()[33m.[39mappendLine(line)[33m;[39m
    [31m[1m>[22m[39m[90m 84 |[39m     console[33m.[39merror(line)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 85 |[39m }
     [90m 86 |[39m[0m

      at error (src/logger.ts:84:13)
      at new TicketsTreeDataProvider (src/ui/ticketsTreeProvider.ts:36:21)
      at tests/ui/ticketsTreeProvider.test.ts:47:26
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.<anonymous> (tests/ui/ticketsTreeProvider.test.ts:47:61)

  console.log
    [INFO] 2026-02-03T02:02:41.031Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.037Z Migrating tickets table: adding type column

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.053Z Migration complete: type column added

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.053Z Ticket DB initialized: SQLite at C:\mock\extension\path\.coe\tickets.db

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.079Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.084Z Ticket DB initialized: SQLite at C:\mock\extension\path\.coe\tickets.db

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.087Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.090Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.093Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.error
    [ERROR] 2026-02-03T02:02:41.094Z Failed to load tickets: Error: Database connection failed

    [0m [90m 82 |[39m     [36mconst[39m line [33m=[39m [32m`[ERROR] ${new Date().toISOString()} ${msg}`[39m[33m;[39m
     [90m 83 |[39m     getOutputChannel()[33m.[39mappendLine(line)[33m;[39m
    [31m[1m>[22m[39m[90m 84 |[39m     console[33m.[39merror(line)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 85 |[39m }
     [90m 86 |[39m[0m

      at error (src/logger.ts:84:13)
      at TicketsTreeDataProvider.getChildren (src/ui/ticketsTreeProvider.ts:79:21)
      at Object.<anonymous> (tests/ui/ticketsTreeProvider.test.ts:147:27)

  console.log
    [INFO] 2026-02-03T02:02:41.098Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.103Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.106Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.109Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.115Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.115Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.117Z Created ticket: TICKET-1770084161117

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.119Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.121Z Updated ticket: TICKET-1770084161117

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.121Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.121Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.124Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.127Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.128Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.129Z Created ticket: TICKET-1770084161129

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.129Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.130Z Updated ticket: TICKET-1770084161129

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.130Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.131Z Updated ticket: TICKET-1770084161129

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.131Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.129Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.133Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.135Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.137Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.139Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.138Z Ticket DB initialized: In-memory mode

      at log (src/logger.ts:68:17)

PASS tests/llmService.test.ts
  LLM Service
    initializeLLMService
      Î“ÃªÃœ should throw error if fetch is not available (Node <18) (49 ms)
      Î“ÃªÃœ should use default config if file is missing (1 ms)
      Î“ÃªÃœ should read config from file if it exists (1 ms)
      Î“ÃªÃœ should validate and use defaults for invalid timeoutSeconds (1 ms)
      Î“ÃªÃœ should validate and use defaults for invalid maxTokens (1 ms)
      Î“ÃªÃœ should handle JSON parse errors gracefully (1 ms)
    completeLLM
      Î“ÃªÃœ should make successful LLM request (2 ms)
      Î“ÃªÃœ should include system prompt if provided (1 ms)
      Î“ÃªÃœ should handle network errors and create blocked ticket (2 ms)
      Î“ÃªÃœ should handle HTTP error responses (1 ms)
      Î“ÃªÃœ should handle timeout with AbortError (1 ms)
      Î“ÃªÃœ should handle ECONNREFUSED error specifically (1 ms)
    streamLLM
      Î“ÃªÃœ should stream chunks and accumulate response (2 ms)
      Î“ÃªÃœ should skip malformed SSE lines gracefully (1 ms)
      Î“ÃªÃœ should handle streaming network errors (2 ms)
      Î“ÃªÃœ should handle HTTP error in streaming (1 ms)
      Î“Ã¹Ã¯ skipped should abort on inactivity timeout
      Î“Ã¹Ã¯ skipped should abort on startup timeout
      Î“Ã¹Ã¯ skipped should abort on inactivity timeout after first chunk

  console.log
    [INFO] 2026-02-03T02:02:41.140Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.142Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.140Z Created ticket: TICKET-1770084161140

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.144Z Emitting change event to refresh sidebar

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.145Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.148Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.150Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.151Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.155Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.156Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.157Z Ticket change event received, refreshing tree view

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.158Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.160Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.161Z Ticket change event received, refreshing tree view

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.162Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.166Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.170Z TicketsTreeProvider subscribing to ticket changes

      at log (src/logger.ts:68:17)

PASS tests/extension.test.ts
  Extension Commands
    Î“ÃªÃœ should register the COE: Plan Task command (5 ms)
    Î“ÃªÃœ should register the COE: Verify Task command (9 ms)
    Î“ÃªÃœ should register the COE: Ask Answer Agent command (5 ms)
    Î“ÃªÃœ should register the COE: Open Ticket command (1 ms)
    Î“ÃªÃœ should open a ticket with description when clicked (1 ms)
    Î“ÃªÃœ should show fallback content when ticket has no description (2 ms)
    Î“ÃªÃœ should show warning when ticket not found (3 ms)
    Orchestration Flow
      Î“ÃªÃœ should register the COE: Verify Last Ticket command (2 ms)
      Î“ÃªÃœ should handle verify last ticket with PASS result (1 ms)
      Î“ÃªÃœ should handle verify last ticket with FAIL result (1 ms)
      Î“ÃªÃœ should show info message when no open ticket exists (2 ms)
      Î“ÃªÃœ should setup auto-planning listener on startup (1 ms)
    Context Menu Commands
      Î“ÃªÃœ should register the COE: View Ticket Progress command (1 ms)
      Î“ÃªÃœ should register the COE: Update Ticket Status command (2 ms)
      Î“ÃªÃœ should register the COE: Add Ticket Comment command (2 ms)
      Î“ÃªÃœ should execute openTicket when viewTicketProgress is called (1 ms)
      Î“ÃªÃœ should show warning when viewTicketProgress called with no ticket ID (4 ms)
      Î“ÃªÃœ should update ticket status when updateTicketStatus called with selection (3 ms)
      Î“ÃªÃœ should handle user cancellation in updateTicketStatus (1 ms)
      Î“ÃªÃœ should show warning when updateTicketStatus ticket not found (2 ms)
      Î“ÃªÃœ should add comment to ticket when addTicketComment called (35 ms)
      Î“ÃªÃœ should validate comment length in addTicketComment (1 ms)
      Î“ÃªÃœ should handle user cancellation in addTicketComment (1 ms)
      Î“ÃªÃœ should show warning when addTicketComment ticket not found (2 ms)

PASS tests/ui/ticketsTreeProvider.test.ts
  TicketsTreeDataProvider
    constructor
      Î“ÃªÃœ should subscribe to ticket changes (121 ms)
      Î“ÃªÃœ should handle subscription errors gracefully (15 ms)
    getChildren
      Î“ÃªÃœ should return ticket items for open tickets (46 ms)
      Î“ÃªÃœ should filter out done tickets (5 ms)
      Î“ÃªÃœ should show placeholder when no open tickets (4 ms)
      Î“ÃªÃœ should show placeholder when all tickets are done (2 ms)
      Î“ÃªÃœ should handle database errors gracefully (5 ms)
      Î“ÃªÃœ should return empty array when element is provided (no children) (6 ms)
      Î“ÃªÃœ should set correct descriptions with status and date (2 ms)
      Î“ÃªÃœ should include full ticket description in tooltip for hover-to-read (2 ms)
      Î“ÃªÃœ should use correct icons for different statuses (6 ms)
    getTreeItem
      Î“ÃªÃœ should return the element unchanged (3 ms)
    plan preview extraction from description
      Î“ÃªÃœ should extract plan preview from ticket.description (3 ms)
      Î“ÃªÃœ should truncate plan preview to 200 characters (3 ms)
      Î“ÃªÃœ should handle exactly 200 character plan without ellipsis (2 ms)
      Î“ÃªÃœ should clean whitespace in plan preview (4 ms)
      Î“ÃªÃœ should show "Î“Ã‡Ã¶" when no description (1 ms)
      Î“ÃªÃœ should show "Î“Ã‡Ã¶" when description is empty string (2 ms)
      Î“ÃªÃœ should set tooltip to full description for hover-to-read (1 ms)
      Î“ÃªÃœ should set tooltip to "No plan stored yet" when no description (1 ms)
      Î“ÃªÃœ should handle multiple tickets with different plan lengths (2 ms)
    TreeItem command for clickable tickets
      Î“ÃªÃœ should set command property on TreeItem to make it clickable (2 ms)
      Î“ÃªÃœ should pass correct ticket ID to command arguments (2 ms)
    refresh
      Î“ÃªÃœ should fire onDidChangeTreeData event (1 ms)
    onDidChangeTreeData
      Î“ÃªÃœ should expose event emitter (2 ms)
      Î“ÃªÃœ should trigger listeners when fired (3 ms)
    auto-refresh on ticket changes
      Î“ÃªÃœ should call refresh when ticket change event fires (4 ms)
      Î“ÃªÃœ should fire onDidChangeTreeData when ticket change event received (4 ms)
    contextValue for context menus
      Î“ÃªÃœ should set contextValue to "ticket" on TreeItem when tickets exist (3 ms)
      Î“ÃªÃœ should set contextValue on all ticket items (4 ms)
      Î“ÃªÃœ should not set contextValue on placeholder item when no tickets (2 ms)

  console.log
    [INFO] 2026-02-03T02:02:41.192Z Ticket DB initialized: SQLite at C:\mock\extension\path\.coe\tickets.db

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.284Z Ticket DB initialized: SQLite at C:\mock\extension\path\.coe\tickets.db

      at log (src/logger.ts:68:17)

  console.log
    [INFO] 2026-02-03T02:02:41.333Z Ticket DB initialized: SQLite at C:\mock\extension\path\.coe\tickets.db

      at log (src/logger.ts:68:17)

PASS tests/ui/llmStatusBar.test.ts
  LlmStatusBarManager
    Î“ÃªÃœ shows spinner on first start and hides after debounce (3 ms)
    Î“ÃªÃœ keeps spinner for concurrent calls (1 ms)
    Î“ÃªÃœ cancels pending hide when a new call starts (2 ms)

  console.log
    [INFO] 2026-02-03T02:02:41.291Z Test info message

      at log (src/logger.ts:68:17)

PASS tests/example.test.ts
  Î“ÃªÃœ hello world! (1 ms)

PASS tests/ticketDb.test.ts (5.063 s)
  TicketDb
    initialization
      Î“ÃªÃœ should initialize in-memory mode when sqlite3 fails (197 ms)
      Î“ÃªÃœ should create .coe directory if missing (4 ms)
    CRUD operations (in-memory)
      Î“ÃªÃœ should create a ticket (10 ms)
      Î“ÃªÃœ should create a ticket with ai_to_human type (7 ms)
      Î“ÃªÃœ should retrieve ticket with type field (7 ms)
      Î“ÃªÃœ should handle ticket without type (backward compatibility) (9 ms)
      Î“ÃªÃœ should retrieve a ticket by ID (5 ms)
      Î“ÃªÃœ should return null for non-existent ticket (4 ms)
      Î“ÃªÃœ should list all tickets (8 ms)
      Î“ÃªÃœ should throw error if methods called before init (272 ms)
    SQLite Mode Operations
      Î“ÃªÃœ should initialize with SQLite when module loads successfully (38 ms)
      Î“ÃªÃœ should create ticket in SQLite mode (75 ms)
      Î“ÃªÃœ should retrieve all tickets from SQLite (67 ms)
    updateTicket
      Î“ÃªÃœ should update ticket in in-memory mode (11 ms)
      Î“ÃªÃœ should update ticket in SQLite mode (77 ms)
      Î“ÃªÃœ should return null for non-existent ticket (14 ms)
      Î“ÃªÃœ should emit change event on update (9 ms)
    Migration & Backward Compatibility
      Î“ÃªÃœ should migrate SQLite table without type column (70 ms)
      Î“ÃªÃœ should read old tickets without type field as undefined (46 ms)
    Integration: Full CRUD Flow
      Î“ÃªÃœ should complete full CRUD lifecycle: create Î“Ã¥Ã† read Î“Ã¥Ã† update Î“Ã¥Ã† read (22 ms)
      Î“ÃªÃœ should handle concurrent updates on same ticket (9 ms)
      Î“ÃªÃœ should gracefully fall back to in-memory when SQLite fails (13 ms)
    Error Handling
      Î“ÃªÃœ should handle createTicket error in SQLite mode (60 ms)
      Î“ÃªÃœ should handle getAllTickets error in SQLite mode (101 ms)
      Î“ÃªÃœ should handle getTicket error in SQLite mode (40 ms)
      Î“ÃªÃœ should warn when initialize is called twice (4 ms)

  console.warn
    [WARN] 2026-02-03T02:02:41.358Z Test warning message

    [0m [90m 74 |[39m         [36mconst[39m line [33m=[39m [32m`[WARN] ${new Date().toISOString()} ${message}`[39m[33m;[39m
     [90m 75 |[39m         getOutputChannel()[33m.[39mappendLine(line)[33m;[39m
    [31m[1m>[22m[39m[90m 76 |[39m         console[33m.[39mwarn(line)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 77 |[39m     }
     [90m 78 |[39m }
     [90m 79 |[39m[0m

      at warn (src/logger.ts:76:17)
      at tests/logger.test.ts:118:16
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.<anonymous> (tests/logger.test.ts:119:14)

  console.error
    [ERROR] 2026-02-03T02:02:41.376Z Test error message

    [0m [90m 82 |[39m     [36mconst[39m line [33m=[39m [32m`[ERROR] ${new Date().toISOString()} ${msg}`[39m[33m;[39m
     [90m 83 |[39m     getOutputChannel()[33m.[39mappendLine(line)[33m;[39m
    [31m[1m>[22m[39m[90m 84 |[39m     console[33m.[39merror(line)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 85 |[39m }
     [90m 86 |[39m[0m

      at error (src/logger.ts:84:13)
      at tests/logger.test.ts:130:17
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.<anonymous> (tests/logger.test.ts:131:14)

  console.error
    [ERROR] 2026-02-03T02:02:41.382Z Test error object

    [0m [90m 82 |[39m     [36mconst[39m line [33m=[39m [32m`[ERROR] ${new Date().toISOString()} ${msg}`[39m[33m;[39m
     [90m 83 |[39m     getOutputChannel()[33m.[39mappendLine(line)[33m;[39m
    [31m[1m>[22m[39m[90m 84 |[39m     console[33m.[39merror(line)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 85 |[39m }
     [90m 86 |[39m[0m

      at error (src/logger.ts:84:13)
      at tests/logger.test.ts:142:17
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.<anonymous> (tests/logger.test.ts:143:14)

PASS tests/logger.test.ts
  Logger
    initializeLogger
      Î“ÃªÃœ should initialize without throwing errors when config file does not exist (8 ms)
      Î“ÃªÃœ should initialize with default log level when config file is missing
      Î“ÃªÃœ should read log level from config file when it exists (5 ms)
      Î“ÃªÃœ should handle invalid JSON in config file gracefully (1 ms)
    logInfo
      Î“ÃªÃœ should log info messages (67 ms)
    logWarn
      Î“ÃªÃœ should log warning messages (17 ms)
    logError
      Î“ÃªÃœ should log error messages as strings (4 ms)
      Î“ÃªÃœ should log Error objects (8 ms)

PASS tests/mcpServer.test.ts (5.279 s)
  MCP Server
    Server Lifecycle
      Î“ÃªÃœ should start the server successfully (6 ms)
      Î“ÃªÃœ should stop the server successfully
      Î“ÃªÃœ should not start the server twice (1 ms)
    JSON-RPC Request Handling
      Î“ÃªÃœ should handle valid getNextTask request (70 ms)
      Î“ÃªÃœ should handle invalid JSON with parse error (64 ms)
      Î“ÃªÃœ should handle unknown method with method not found error (114 ms)
      Î“ÃªÃœ should handle invalid JSON-RPC version (92 ms)
      Î“ÃªÃœ should handle orchestrator error gracefully (61 ms)
    Edge Cases
      Î“ÃªÃœ should handle request without id (61 ms)
      Î“ÃªÃœ should handle empty response from orchestrator (75 ms)
    COE Agent Tool
      Î“ÃªÃœ should route "plan" command to planning agent (62 ms)
      Î“ÃªÃœ should route "verify" command and format result as PASS/FAIL (57 ms)
      Î“ÃªÃœ should format FAIL verification result correctly (74 ms)
      Î“ÃªÃœ should route "ask" command to answer agent (78 ms)
      Î“ÃªÃœ should return error for invalid command (69 ms)
      Î“ÃªÃœ should return error for missing task arg in plan command (61 ms)
      Î“ÃªÃœ should return error for missing code arg in verify command (73 ms)
      Î“ÃªÃœ should return error for missing question arg in ask command (64 ms)
      Î“ÃªÃœ should return error for missing args object (61 ms)
      Î“ÃªÃœ should handle orchestrator errors gracefully (60 ms)
      Î“ÃªÃœ should use default task description for verify when not provided (61 ms)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
-------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------
File                     | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                   
-------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------
All files                |   85.62 |    69.97 |   86.42 |    85.7 |                                                                                                                                     
 src                     |   70.32 |    48.35 |      75 |   70.58 |                                                                                                                                     
  extension.ts           |   66.25 |    39.18 |   68.18 |   66.52 | 24-26,37-64,127-129,174-175,179-180,201,206-208,235-253,264-302,359-361,386-388,405-407,443-445,462-464,475,509-511,518-527,539-540 
  logger.ts              |     100 |    88.23 |     100 |     100 | 45-65                                                                                                                               
 src/agents              |     100 |       80 |     100 |     100 |                                                                                                                                     
  answerAgent.ts         |     100 |       80 |     100 |     100 | 123-135,160,179                                                                                                                     
 src/mcpServer           |   86.45 |    68.05 |   72.72 |   86.45 |                                                                                                                                     
  mcpServer.ts           |   86.45 |    68.05 |   72.72 |   86.45 | 71,93,221-222,278-284,291-293,301                                                                                                   
 src/services            |   88.06 |    71.67 |   87.69 |   88.14 |                                                                                                                                     
  llmService.ts          |   84.51 |     67.5 |   66.66 |   85.06 | 64,129-130,166,190-191,267,296,301-303,309-316,353-355,413,415                                                                      
  orchestrator.ts        |   86.72 |    67.02 |      80 |    86.6 | 131,323,522-579,633,645-648,662,674-677,703-706,711                                                                                 
  ticketDb.ts            |   94.61 |    84.74 |     100 |   94.53 | 56,82,114,300,308,316,324                                                                                                           
 src/ui                  |   98.69 |    96.49 |   96.66 |   98.67 |                                                                                                                                     
  agentStatusTracker.ts  |     100 |       90 |     100 |     100 | 42                                                                                                                                  
  agentsTreeProvider.ts  |   98.18 |      100 |    87.5 |   98.18 | 34                                                                                                                                  
  llmStatusBar.ts        |     100 |      100 |     100 |     100 |                                                                                                                                     
  ticketsTreeProvider.ts |   98.03 |    92.85 |     100 |   97.95 | 149                                                                                                                                 
-------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------
Test Suites: 12 passed, 12 total
Tests:       3 skipped, 280 passed, 283 total
Snapshots:   0 total
Time:        7.361 s, estimated 12 s
Ran all test suites.
