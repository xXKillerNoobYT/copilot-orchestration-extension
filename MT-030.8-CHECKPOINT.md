# MT-030.8 Implementation Progress

## Current Status
- Schema already 100% complete at `src/agents/custom/schema.ts` lines 225-260
- AgentMetadataSchema includes: author, version, createdAt, updatedAt, tags
- All fields are properly validated

## HTML Pattern to Follow
From `getGoalsSection()` at line 1117 in customAgentBuilder.ts:
```typescript
private getGoalsSection(): string {
    return `
        <div class="section" id="section-goals">
            <div class="section-header" data-section="goals">
                <h2 class="section-title">ðŸŽ¯ Goals</h2>
                <span class="section-toggle">â–¼</span>
            </div>
            <div class="section-content" id="content-goals">
                <div class="form-group">
                    <!-- Form inputs here -->
                </div>
            </div>
        </div>
    `;
}
```

## Implementation Plan

### Step 1: Add getMetadataSection() method after getChecklistSection()
Location: After line 1170+ (after getChecklistSection ends)

**Exact Template Needed**:
```typescript
private getMetadataSection(): string {
    return `
        <div class="section" id="section-metadata">
            <div class="section-header" data-section="metadata">
                <h2 class="section-title">ðŸ“‹ Metadata</h2>
                <span class="section-toggle">â–¼</span>
            </div>
            <div class="section-content" id="content-metadata">
                <div class="form-group">
                    <label class="form-label">Author</label>
                    <input type="text" id="author" maxlength="100" placeholder="Enter author name">
                    <span id="author-count">0</span>/100
                </div>
                <div class="form-group">
                    <label class="form-label">Version</label>
                    <input type="text" id="version" placeholder="1.0.0" pattern="^\\d+\\.\\d+\\.\\d+$">
                    <span id="version-error" class="error"></span>
                </div>
                <div class="form-group">
                    <label class="form-label">Tags</label>
                    <input type="text" id="tags" placeholder="comma, separated, tags" maxlength="300">
                    <span class="help-text">Max 10 tags, 30 chars each</span>
                </div>
            </div>
        </div>
    `;
}
```

### Step 2: Add to HTML layout
Location: Line 593 in customAgentBuilder.ts, update getHtmlContent():
Change:
```typescript
${this.getSystemPromptSection()}
${this.getGoalsSection()}
```
To:
```typescript
${this.getSystemPromptSection()}
${this.getGoalsSection()}
${this.getMetadataSection()}
```

### Step 3: Add CSS (in getCssStyles method)
Add before closing styles:
```css
.metadata-section {
    background-color: rgba(100, 100, 255, 0.05);
    border-left: 3px solid #5555ff;
    padding: 12px;
    margin: 16px 0;
}

#author-count, #version-error {
    font-size: 12px;
    color: #999;
}

#version-error.has-error {
    color: #ff4444;
}
```

### Step 4: Add JavaScript Handlers (in getJavaScript method)
In setupEventListeners() function, add:
```typescript
document.getElementById('author')?.addEventListener('input', (e) => {
    const authorInput = e.target as HTMLInputElement;
    currentAgent.metadata = currentAgent.metadata || {};
    currentAgent.metadata.author = authorInput.value;
    document.getElementById('author-count')!.textContent = authorInput.value.length;
});

document.getElementById('version')?.addEventListener('change', (e) => {
    const versionInput = e.target as HTMLInputElement;
    const isValid = /^\d+\.\d+\.\d+$/.test(versionInput.value);
    const errorEl = document.getElementById('version-error')!;
    
    if (isValid) {
        currentAgent.metadata = currentAgent.metadata || {};
        currentAgent.metadata.version = versionInput.value;
        errorEl.classList.remove('has-error');
        errorEl.textContent = '';
    } else {
        errorEl.classList.add('has-error');
        errorEl.textContent = 'Format: X.Y.Z (e.g., 1.0.0)';
    }
});

document.getElementById('tags')?.addEventListener('input', (e) => {
    const tagsInput = e.target as HTMLInputElement;
    const tags = tagsInput.value
        .split(',')
        .map(t => t.trim())
        .filter(t => t.length > 0);
    
    if (tags.length <= 10) {
        currentAgent.metadata = currentAgent.metadata || {};
        currentAgent.metadata.tags = tags;
    }
});
```

### Step 5: Add load handlers
In loadAgent() function after setting basic fields, add:
```typescript
if (agent.metadata?.author) {
    (document.getElementById('author') as HTMLInputElement).value = agent.metadata.author;
}
if (agent.metadata?.version) {
    (document.getElementById('version') as HTMLInputElement).value = agent.metadata.version;
}
if (agent.metadata?.tags && agent.metadata.tags.length > 0) {
    (document.getElementById('tags') as HTMLInputElement).value = agent.metadata.tags.join(', ');
}
```

## Key Constants (from schema.ts)
- AUTHOR_MAX_LENGTH: 100
- TAGS_MAX: 10
- TAG_MAX_LENGTH: 30

## Files to Modify
1. `src/ui/customAgentBuilder.ts` - Add getMetadataSection + CSS + JS handlers
2. `tests/ui/customAgentBuilder.metadata.test.ts` - NEW file with tests

## Time Estimate
- HTML section: 3 min
- Add to layout: 1 min
- CSS: 2 min
- JavaScript handlers: 6 min
- Load handlers: 2 min
- Tests: 8 min
- Total: ~22 min

## Next Action
1. Add getMetadataSection() method around line 1200
2. Update line 593 to include getMetadataSection()
3. Add CSS to getCssStyles()
4. Add event listeners in getJavaScript()
5. Run npm run compile
6. Create tests
