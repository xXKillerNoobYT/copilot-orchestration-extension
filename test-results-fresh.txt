
> copilot-orchestration-extension@0.0.1 test:once
> jest

  console.log
    [INFO] 2026-02-05T04:19:42.611Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.690Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.699Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.701Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.704Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.706Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.716Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.718Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.721Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.723Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.725Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.727Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.729Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.737Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.739Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.741Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.744Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.746Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.747Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.754Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.757Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.758Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.761Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.764Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.765Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.772Z Cleaned up 1 temp file(s)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.779Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.781Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.783Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.785Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.787Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.789Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.791Z Saved payload 290abf64e10a9c9fe856f277b1661b395782a0947bc136ce305b55331b1a5286 from test (type: example)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.796Z Loaded payload 290abf64e10a9c9fe856f277b1661b395782a0947bc136ce305b55331b1a5286 from cache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.802Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.803Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.805Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.807Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.815Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.816Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.821Z Saved payload 1b2d5ef06214e4b523e0d9a31d72d71f2145c01c0e51fb19924be08eea7e0b71 from test (type: example)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.823Z Payload 1b2d5ef06214e4b523e0d9a31d72d71f2145c01c0e51fb19924be08eea7e0b71 already cached, skipping

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.828Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.830Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.832Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.834Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.837Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.838Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.840Z Saved payload e1d7c49f3a04e1ec1a5b150ec68041c903cd75fda52aa1239fd586439ef1154b from test (type: example)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.842Z Deleted payload e1d7c49f3a04e1ec1a5b150ec68041c903cd75fda52aa1239fd586439ef1154b from cache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.850Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.852Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.869Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.871Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.873Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.874Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.878Z Saved payload e1d7c49f3a04e1ec1a5b150ec68041c903cd75fda52aa1239fd586439ef1154b from test (type: example)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.884Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.886Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.887Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

PASS tests/mcpServer/tools/askQuestion.spec.ts
  askQuestion Tool
    Parameter Validation
      Î“ÃªÃœ Test 1: should reject non-object params (42 ms)
      Î“ÃªÃœ Test 2: should require non-empty question (1 ms)
      Î“ÃªÃœ Test 3: should reject non-string chatId (1 ms)
      Î“ÃªÃœ Test 4: should accept valid parameters
    Answer Handling
      Î“ÃªÃœ Test 5: should return answer on success (4 ms)
      Î“ÃªÃœ Test 6: should create ticket on timeout (7 ms)
      Î“ÃªÃœ Test 7: should return internal error on failure (10 ms)

  console.log
    [INFO] 2026-02-05T04:19:42.889Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.891Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.892Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.896Z Saved payload 015abd7f5cc57a2dd94b7590f04ad8084273905ee33ec5cebeae62276a97f862 from test (type: example)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.898Z Saved payload 0ab1a6d394cd30195f0642b67ae1180c375ffadf5dd7f39c390668b5fdb6da93 from test (type: example)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.908Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.915Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.920Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.922Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.924Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.925Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.933Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.934Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.936Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.937Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.947Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.948Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.958Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.964Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.966Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.968Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.970Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.971Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.975Z Saved payload e1d7c49f3a04e1ec1a5b150ec68041c903cd75fda52aa1239fd586439ef1154b from llm (type: response)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.976Z Loaded payload e1d7c49f3a04e1ec1a5b150ec68041c903cd75fda52aa1239fd586439ef1154b from cache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.979Z Added e1d7c49f3a04e1ec1a5b150ec68041c903cd75fda52aa1239fd586439ef1154b to cache index

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.986Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.988Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.990Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.992Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.995Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:42.996Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.000Z Saved payload e1d7c49f3a04e1ec1a5b150ec68041c903cd75fda52aa1239fd586439ef1154b from test (type: example)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.002Z Loaded payload e1d7c49f3a04e1ec1a5b150ec68041c903cd75fda52aa1239fd586439ef1154b from cache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.008Z Added e1d7c49f3a04e1ec1a5b150ec68041c903cd75fda52aa1239fd586439ef1154b to cache index

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.017Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.040Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.042Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.044Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.047Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.048Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.050Z Saved payload 015abd7f5cc57a2dd94b7590f04ad8084273905ee33ec5cebeae62276a97f862 from llm (type: response)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.052Z Saved payload 0ab1a6d394cd30195f0642b67ae1180c375ffadf5dd7f39c390668b5fdb6da93 from github (type: issue)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.091Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.094Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.096Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.098Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.100Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.101Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.103Z Saved payload 1c1a39e1e23a7e42e9eaa400a8045e356704ce7421deaf3576ad1c2697a8e796 from test (type: example)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.115Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.117Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.120Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.122Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.125Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.127Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.155Z Starting retention policy cleanup (retention period: 7 days)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.158Z No items exceeded retention period

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.168Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.170Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.175Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.178Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.180Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.181Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.187Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.189Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.191Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.193Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.196Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.197Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.206Z Cache size (NaN undefined) exceeds threshold (1000 B), starting LRU pruning

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.209Z No items to delete (minimum count reached)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.216Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.218Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.220Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.222Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.224Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.226Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.235Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.238Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

PASS tests/index.test.ts
  getMCPServerInstance
    Î“ÃªÃœ should return null if the MCP server is not initialized (1 ms)
    Î“ÃªÃœ should return the MCP server instance after initialization (1 ms)
    Î“ÃªÃœ should return the same instance if called multiple times after initialization (2 ms)
    Î“ÃªÃœ should return null after the MCP server is reset (1 ms)
    Î“ÃªÃœ should not initialize a new MCP server if one already exists (1 ms)
    Î“ÃªÃœ should log appropriate messages during initialization (1 ms)
  initializeMCPServer
    Î“ÃªÃœ should initialize and start the MCP server if not already initialized (1 ms)
    Î“ÃªÃœ should not initialize a new MCP server if one already exists
    Î“ÃªÃœ should handle resetting the MCP server for tests
    Î“ÃªÃœ should handle multiple calls to resetMCPServerForTests gracefully (1 ms)
    Î“ÃªÃœ should return null if MCP server is not initialized (1 ms)
    Î“ÃªÃœ should return the MCP server instance if initialized
    Î“ÃªÃœ should log appropriate messages when MCP server is initialized in standalone mode (1 ms)
  resetMCPServerForTests
    Î“ÃªÃœ should stop and reset the MCP server instance if it exists (1 ms)
    Î“ÃªÃœ should do nothing if no MCP server instance exists

  console.log
    [INFO] 2026-02-05T04:19:43.240Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.242Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.245Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.246Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.252Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.253Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.255Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.257Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.259Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.260Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.301Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.303Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.304Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.306Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.308Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.309Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.314Z Saved payload a39cc2a7cc07de8dde84e4b10ca219aa5488eea3d882a39b430c58142cd08565 from test (type: example)

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.320Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.322Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.324Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.326Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.329Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.330Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.335Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.337Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.338Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.340Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.342Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.344Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.349Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.351Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.353Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.354Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.357Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.358Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.391Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.394Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.396Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.398Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.400Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.401Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.411Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.413Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.415Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.417Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.419Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.420Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.438Z Scanning 1 tracked file(s) for changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.447Z File changed: C:\Users\weird\OneDrive\Documents\GitHub\copilot-orchestration-extension\tests\cache\__test_cache__\test.txt

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.450Z Change detection complete: 1 file(s) changed, 1 cache entries invalidated

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.454Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.456Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.458Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.459Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.462Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.463Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.474Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.487Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.490Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.491Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.494Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.496Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

  console.error
    [ERROR] 2026-02-05T04:19:43.498Z Failed to load cache index: Unexpected token 'c', "corrupted {{{ json" is not valid JSON

    [0m [90m 83 |[39m     [36mconst[39m line [33m=[39m [32m`[ERROR] ${new Date().toISOString()} ${msg}`[39m[33m;[39m
     [90m 84 |[39m     getOutputChannel()[33m.[39mappendLine(line)[33m;[39m
    [31m[1m>[22m[39m[90m 85 |[39m     console[33m.[39merror(line)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 86 |[39m }
     [90m 87 |[39m[0m

      at logError (src/logger.ts:85:13)
      at loadCacheIndex (src/services/cache/index.ts:125:17)
      at Object.<anonymous> (tests/cache/cacheManagement.spec.ts:556:41)

  console.log
    [INFO] 2026-02-05T04:19:43.508Z Created cache directory: root

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.511Z Created cache directory: offlineCache

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.513Z Created cache directory: processed

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.515Z Created cache directory: temp

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.517Z Created cache index file

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:43.518Z Cache structure initialized successfully

      at logInfo (src/logger.ts:69:17)

FAIL tests/cache/cacheManagement.spec.ts (5.394 s)
  Cache Management
    Structure - MT-004.1
      Î“ÃªÃœ Test 1: should create all required directories (135 ms)
      Î“ÃªÃœ Test 2: should handle existing directories gracefully (21 ms)
      Î“ÃªÃœ Test 3: should validate cache structure (17 ms)
      Î“ÃªÃœ Test 4: should clean up old temp files (24 ms)
    Storage - MT-004.2
      Î“ÃªÃœ Test 5: should save and load payloads (23 ms)
      Î“ÃªÃœ Test 6: should detect duplicate payloads (26 ms)
      Î“ÃªÃœ Test 7: should delete payloads (22 ms)
      Î“ÃªÃœ Test 8: should calculate payload size (34 ms)
      Î“ÃªÃœ Test 9: should list all payloads (19 ms)
      Î“ÃªÃœ Test 10: should generate consistent hashes (26 ms)
    Index - MT-004.3
      Î“ÃªÃœ Test 11: should load and save cache index (25 ms)
      Î“ÃªÃœ Test 12: should search index with filters (29 ms)
      Î“ÃªÃœ Test 13: should update last accessed time (30 ms)
      â”œÃ¹ Test 14: should calculate cache statistics (46 ms)
    Retention - MT-004.4
      Î“ÃªÃœ Test 15: should identify expired items (21 ms)
      Î“ÃªÃœ Test 16: should apply retention policy (54 ms)
      Î“ÃªÃœ Test 17: should format item age correctly (19 ms)
    Pruning - MT-004.5
      Î“ÃªÃœ Test 18: should prune when size exceeds threshold (28 ms)
      Î“ÃªÃœ Test 19: should preserve minimum items (17 ms)
      Î“ÃªÃœ Test 20: should format bytes correctly (18 ms)
      â”œÃ¹ Test 21: should get cache size info (45 ms)
    Auto-Refresh - MT-004.6
      Î“ÃªÃœ Test 22: should identify stale items (19 ms)
      Î“ÃªÃœ Test 23: should calculate refresh priority (14 ms)
      Î“ÃªÃœ Test 24: should sort items by priority (13 ms)
    Change Detection - MT-004.7
      Î“ÃªÃœ Test 25: should compute file hash (42 ms)
      Î“ÃªÃœ Test 26: should register file hash (19 ms)
      Î“ÃªÃœ Test 27: should detect file changes (44 ms)
      Î“ÃªÃœ Test 28: should untrack files (19 ms)
    Error Recovery
      Î“ÃªÃœ Test 29: should handle corrupted index gracefully (34 ms)
      Î“ÃªÃœ Test 30: should handle missing files during deletion (14 ms)

  Î“Ã¹Ã… Cache Management Î“Ã‡â•‘ Index - MT-004.3 Î“Ã‡â•‘ Test 14: should calculate cache statistics

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: undefined

      315 |
      316 |             const stats = getCacheStats(mockContext);
    > 317 |             expect(stats.totalItems).toBe(0); // Not added to index yet
          |                                      ^
      318 |         });
      319 |     });
      320 |

      at Object.<anonymous> (tests/cache/cacheManagement.spec.ts:317:38)

  Î“Ã¹Ã… Cache Management Î“Ã‡â•‘ Pruning - MT-004.5 Î“Ã‡â•‘ Test 21: should get cache size info

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: undefined

      391 |         it('Test 21: should get cache size info', () => {
      392 |             const info = getCacheSizeInfo(mockContext);
    > 393 |             expect(info.totalBytes).toBe(0);
          |                                     ^
      394 |             expect(info.itemCount).toBe(0);
      395 |         });
      396 |     });

      at Object.<anonymous> (tests/cache/cacheManagement.spec.ts:393:37)

PASS tests/extension.test.ts
  Extension Commands
    Î“ÃªÃœ should register the COE: Plan Task command (7 ms)
    Î“ÃªÃœ should register the COE: Verify Task command (15 ms)
    Î“ÃªÃœ should register the COE: Ask Answer Agent command (3 ms)
    Î“ÃªÃœ should register the COE: Open Ticket command (4 ms)
    Î“ÃªÃœ should open a ticket with description when clicked (6 ms)
    Î“ÃªÃœ should show fallback content when ticket has no description (2 ms)
    Î“ÃªÃœ should show warning when ticket not found (6 ms)
    Orchestration Flow
      Î“ÃªÃœ should register the COE: Verify Last Ticket command (5 ms)
      Î“ÃªÃœ should handle verify last ticket with PASS result (6 ms)
      Î“ÃªÃœ should handle verify last ticket with FAIL result (3 ms)
      Î“ÃªÃœ should show info message when no open ticket exists (3 ms)
      Î“ÃªÃœ should setup auto-planning listener on startup (5 ms)
    Context Menu Commands
      Î“ÃªÃœ should register the COE: View Ticket Progress command (8 ms)
      Î“ÃªÃœ should register the COE: Update Ticket Status command (5 ms)
      Î“ÃªÃœ should register the COE: Add Ticket Comment command (5 ms)
      Î“ÃªÃœ should register the COE: Reply Conversation command (2 ms)
      Î“ÃªÃœ should execute openTicket when viewTicketProgress is called (3 ms)
      Î“ÃªÃœ should show warning when viewTicketProgress called with no ticket ID (2 ms)
      Î“ÃªÃœ should update ticket status when updateTicketStatus called with selection (5 ms)
      Î“ÃªÃœ should handle user cancellation in updateTicketStatus (4 ms)
      Î“ÃªÃœ should show warning when updateTicketStatus ticket not found (2 ms)
      Î“ÃªÃœ should add comment to ticket when addTicketComment called (36 ms)
      Î“ÃªÃœ should validate comment length in addTicketComment (2 ms)
      Î“ÃªÃœ should handle user cancellation in addTicketComment (2 ms)
      Î“ÃªÃœ should show warning when addTicketComment ticket not found (2 ms)
    coe.processTicket command
      Î“ÃªÃœ should register the COE: Process Ticket command (2 ms)
      Î“ÃªÃœ should process ticket by calling planning agent (2 ms)
      Î“ÃªÃœ should handle ticket not found error (1 ms)
      Î“ÃªÃœ should handle processing errors gracefully (1 ms)
    coe.researchWithAgent command
      Î“ÃªÃœ should register the COE: Research with Agent command (2 ms)
      Î“ÃªÃœ should show info message when Research Agent is disabled in settings (2 ms)
      Î“ÃªÃœ should abort silently when no query is provided (1 ms)
      Î“ÃªÃœ should abort silently when empty query is provided (5 ms)
  Extension Helpers
    Î“ÃªÃœ should update the status bar text and tooltip (3 ms)
    Î“ÃªÃœ should auto-plan for new ai_to_human tickets (5 ms)
    Î“ÃªÃœ should skip auto-planning when autoProcessTickets is false (Manual mode) (2 ms)
    Î“ÃªÃœ should run Ask Answer Agent continue with active chat (28 ms)
    Î“ÃªÃœ should warn when continuing without an active chat (3 ms)
    Î“ÃªÃœ should show error when opening a ticket fails (2 ms)
    Î“ÃªÃœ should refresh agents and tickets via commands (2 ms)
    Î“ÃªÃœ should run Ask Answer Agent with a new question (2 ms)
    Î“ÃªÃœ should show error when verify last ticket fails (1 ms)
  Answer Agent Persistence
    Î“ÃªÃœ should restore Answer Agent history on activate (1 ms)
    Î“ÃªÃœ should warn and continue if persistence fails on deactivate (1 ms)
    coe.enableAgent command
      Î“ÃªÃœ should register the COE: Enable Agent command (1 ms)
      Î“ÃªÃœ should enable a disabled agent and refresh tree view (1 ms)
      Î“ÃªÃœ should handle missing tree item gracefully (1 ms)
    coe.disableAgent command
      Î“ÃªÃœ should register the COE: Disable Agent command (2 ms)
      Î“ÃªÃœ should disable an enabled agent and refresh tree view (1 ms)
      Î“ÃªÃœ should handle errors when updating settings (1 ms)
    coe.toggleAutoProcessing command
      Î“ÃªÃœ should register the COE: Toggle Auto Processing command (1 ms)
      Î“ÃªÃœ should toggle from Manual to Auto mode (1 ms)
      Î“ÃªÃœ should toggle from Auto to Manual mode (1 ms)
      Î“ÃªÃœ should handle errors when updating settings (1 ms)

  console.log
    [INFO] 2026-02-05T04:19:44.050Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.119Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.123Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.error
    [ERROR] 2026-02-05T04:19:44.128Z Failed to subscribe to ticket changes: Error: Subscription failed

    [0m [90m 83 |[39m     [36mconst[39m line [33m=[39m [32m`[ERROR] ${new Date().toISOString()} ${msg}`[39m[33m;[39m
     [90m 84 |[39m     getOutputChannel()[33m.[39mappendLine(line)[33m;[39m
    [31m[1m>[22m[39m[90m 85 |[39m     console[33m.[39merror(line)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 86 |[39m }
     [90m 87 |[39m[0m

      at logError (src/logger.ts:85:13)
      at new TicketsTreeDataProvider (src/ui/ticketsTreeProvider.ts:36:21)
      at tests/ui/ticketsTreeProvider.test.ts:47:26
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.<anonymous> (tests/ui/ticketsTreeProvider.test.ts:47:61)

  console.log
    [INFO] 2026-02-05T04:19:44.134Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.137Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.139Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.142Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.144Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.error
    [ERROR] 2026-02-05T04:19:44.146Z Failed to load tickets: Error: Database connection failed

    [0m [90m 83 |[39m     [36mconst[39m line [33m=[39m [32m`[ERROR] ${new Date().toISOString()} ${msg}`[39m[33m;[39m
     [90m 84 |[39m     getOutputChannel()[33m.[39mappendLine(line)[33m;[39m
    [31m[1m>[22m[39m[90m 85 |[39m     console[33m.[39merror(line)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 86 |[39m }
     [90m 87 |[39m[0m

      at logError (src/logger.ts:85:13)
      at TicketsTreeDataProvider.getChildren (src/ui/ticketsTreeProvider.ts:79:21)
      at Object.<anonymous> (tests/ui/ticketsTreeProvider.test.ts:147:27)

  console.log
    [INFO] 2026-02-05T04:19:44.152Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.154Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.157Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.161Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.165Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.167Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.171Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.174Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.177Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.181Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.184Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.187Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.190Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.193Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.196Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.199Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.202Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.205Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.207Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.211Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.212Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.214Z Ticket change event received, refreshing tree view

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.217Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.219Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.220Z Ticket change event received, refreshing tree view

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.223Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.225Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.228Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

  console.log
    [INFO] 2026-02-05T04:19:44.230Z TicketsTreeProvider subscribing to ticket changes

      at logInfo (src/logger.ts:69:17)

PASS tests/ui/ticketsTreeProvider.test.ts
  TicketsTreeDataProvider
    constructor
      Î“ÃªÃœ should subscribe to ticket changes (69 ms)
      Î“ÃªÃœ should handle subscription errors gracefully (14 ms)
    getChildren
      Î“ÃªÃœ should return ticket items for open tickets (3 ms)
      Î“ÃªÃœ should filter out done tickets (2 ms)
      Î“ÃªÃœ should show placeholder when no open tickets (2 ms)
      Î“ÃªÃœ should show placeholder when all tickets are done (3 ms)
      Î“ÃªÃœ should handle database errors gracefully (7 ms)
      Î“ÃªÃœ should return empty array when element is provided (no children) (2 ms)
      Î“ÃªÃœ should set correct descriptions with status and date (2 ms)
      Î“ÃªÃœ should include full ticket description in tooltip for hover-to-read (4 ms)
      Î“ÃªÃœ should use correct icons for different statuses (3 ms)
    getTreeItem
      Î“ÃªÃœ should return the element unchanged (1 ms)
    plan preview extraction from description
      Î“ÃªÃœ should extract plan preview from ticket.description (3 ms)
      Î“ÃªÃœ should truncate plan preview to 200 characters (4 ms)
      Î“ÃªÃœ should handle exactly 200 character plan without ellipsis (3 ms)
      Î“ÃªÃœ should clean whitespace in plan preview (3 ms)
      Î“ÃªÃœ should show "Î“Ã‡Ã¶" when no description (3 ms)
      Î“ÃªÃœ should show "Î“Ã‡Ã¶" when description is empty string (2 ms)
      Î“ÃªÃœ should set tooltip to full description for hover-to-read (2 ms)
      Î“ÃªÃœ should set tooltip to "No plan stored yet" when no description (3 ms)
      Î“ÃªÃœ should handle multiple tickets with different plan lengths (2 ms)
    TreeItem command for clickable tickets
      Î“ÃªÃœ should set command property on TreeItem to make it clickable (3 ms)
      Î“ÃªÃœ should pass correct ticket ID to command arguments (2 ms)
    refresh
      Î“ÃªÃœ should fire onDidChangeTreeData event (2 ms)
    onDidChangeTreeData
      Î“ÃªÃœ should expose event emitter (3 ms)
      Î“ÃªÃœ should trigger listeners when fired (3 ms)
    auto-refresh on ticket changes
      Î“ÃªÃœ should call refresh when ticket change event fires (6 ms)
      Î“ÃªÃœ should fire onDidChangeTreeData when ticket change event received (7 ms)
    contextValue for context menus
      Î“ÃªÃœ Test 1: should set contextValue to "ticket" on TreeItem when tickets exist (2 ms)
      Î“ÃªÃœ Test 2: should set contextValue on all ticket items (3 ms)
      Î“ÃªÃœ Test 3: should set pending contextValue on pending tickets (2 ms)
      Î“ÃªÃœ Test 4: should not set contextValue on placeholder item when no tickets (2 ms)

PASS tests/orchestrator.test.ts
  Orchestrator Service
    initialization
      Î“ÃªÃœ Test 1: should initialize with default timeout when config missing (4 ms)
      Î“ÃªÃœ Test 2: should read timeout from config.orchestrator.taskTimeoutSeconds (1 ms)
      Î“ÃªÃœ Test 3: should fallback to llm.timeoutSeconds if orchestrator config missing
    manual mode ticket handling
      Î“ÃªÃœ Test 4: should set ai_to_human ticket to pending when manual mode enabled (2 ms)
      Î“ÃªÃœ Test 5: should skip pending update when auto mode enabled (3 ms)
    queue ordering (FIFO)
      Î“ÃªÃœ Test 6: should return tasks in FIFO order (2 ms)
      Î“ÃªÃœ Test 7: should return null when queue is empty (2 ms)
      Î“ÃªÃœ Test 8: should filter for open and in-progress tickets only (2 ms)
    timeout detection and blocking
      Î“ÃªÃœ Test 9: should create blocked ticket when task idle >30s (using fake timers) (6 ms)
      Î“ÃªÃœ Test 10: should not create duplicate blocked tickets for same task (4 ms)
    edge cases
      Î“ÃªÃœ Test 11: should handle TicketDb errors gracefully (2 ms)
      Î“ÃªÃœ Test 12: should throw error if getNextTask called before initialization (50 ms)
      Î“ÃªÃœ Test 13: should prevent duplicate initialization (1 ms)
    routeQuestionToAnswer
      Î“ÃªÃœ should call LLM with question and return response (2 ms)
      Î“ÃªÃœ should include Answer agent system prompt (1 ms)
      Î“ÃªÃœ should handle LLM failure and return fallback message (1 ms)
      Î“ÃªÃœ should not create duplicate ticket on LLM failure (1 ms)
      Î“ÃªÃœ should log question routing and response (1 ms)
    routeToPlanningAgent
      Î“ÃªÃœ should log chunks and accumulate full plan (2 ms)
      Î“ÃªÃœ should handle empty response gracefully (1 ms)
      Î“ÃªÃœ should truncate long plans in logs (1 ms)
    routeToVerificationAgent
      Î“ÃªÃœ should call completeLLM with verification system prompt (1 ms)
      Î“ÃªÃœ should parse PASS response and avoid ticket creation (1 ms)
      Î“ÃªÃœ should parse FAIL response and create blocked ticket (1 ms)
      Î“ÃªÃœ should default to FAIL on ambiguous response (1 ms)
      Î“ÃªÃœ should truncate long explanations in logs (3 ms)
      Î“ÃªÃœ should fail fast when code diff is empty (2 ms)
      Î“ÃªÃœ should handle LLM errors without creating duplicate tickets (3 ms)
    Planning Agent
      Î“ÃªÃœ should stream plan chunks to logs via callback (3 ms)
      Î“ÃªÃœ should handle empty plan response (1 ms)
      Î“ÃªÃœ should handle planning timeout by returning fallback message (1 ms)
    Answer Agent
      Î“ÃªÃœ should call completeLLM and log response (1 ms)
      Î“ÃªÃœ should create ticket when response contains "ticket" keyword (2 ms)
      Î“ÃªÃœ should create ticket when response contains "create" keyword (3 ms)
      Î“ÃªÃœ should not create ticket for normal response without action keywords (3 ms)
      Î“ÃªÃœ should warn and return early for empty question (3 ms)
      Î“ÃªÃœ should warn and return early for whitespace-only question (2 ms)
      Î“ÃªÃœ should truncate long response in logs (>500 chars) (1 ms)
      Î“ÃªÃœ should handle case-insensitive keyword detection (1 ms)
      Î“ÃªÃœ should handle completeLLM timeout error gracefully (1 ms)
      Î“ÃªÃœ should handle empty LLM response (1 ms)
      Î“ÃªÃœ should create ticket with truncated question in title (2 ms)
  getOrchestratorInstance
    Î“ÃªÃœ should return an instance of OrchestratorService after initialization (1 ms)
    Î“ÃªÃœ should throw an error if the orchestrator is not initialized (2 ms)
    Î“ÃªÃœ should return the same instance on multiple calls after initialization
    Î“ÃªÃœ should log a warning if initializeOrchestrator is called multiple times
    Î“ÃªÃœ should throw an error if getOrchestratorInstance is called after reset
  initializeOrchestrator
    Î“ÃªÃœ should initialize orchestrator using centralized config system (1 ms)
    Î“ÃªÃœ should read timeout from centralized config system (1 ms)
    Î“ÃªÃœ should use validated config from centralized system (validation handled by Zod)
    Î“ÃªÃœ should load tasks from TicketDb during initialization (1 ms)
    Î“ÃªÃœ should handle errors when loading tasks from TicketDb (1 ms)
    Î“ÃªÃœ should warn if orchestrator is already initialized
    Î“ÃªÃœ should use taskTimeoutSeconds from centralized config system (1 ms)
    Î“ÃªÃœ should use default timeout from centralized config (30s)
    Î“ÃªÃœ should register manual mode listener during initialization (1 ms)
    Î“ÃªÃœ should register conversation thread listener during initialization (2 ms)
    Î“ÃªÃœ should use validated config from centralized config system (1 ms)

FAIL tests/ticketDb.test.ts (6.379 s)
  TicketDb
    initialization
      Î“ÃªÃœ should initialize in-memory mode when sqlite3 fails (28 ms)
      Î“ÃªÃœ should create .coe directory if missing (5 ms)
    CRUD operations (in-memory)
      Î“ÃªÃœ should create a ticket (36 ms)
      Î“ÃªÃœ should create a ticket with ai_to_human type (1 ms)
      Î“ÃªÃœ should retrieve ticket with type field (1 ms)
      Î“ÃªÃœ should handle ticket without type (backward compatibility) (1 ms)
      Î“ÃªÃœ should retrieve a ticket by ID (5 ms)
      Î“ÃªÃœ should return null for non-existent ticket (3 ms)
      Î“ÃªÃœ should list all tickets (4 ms)
      Î“ÃªÃœ should throw error if methods called before init (88 ms)
    SQLite Mode Operations
      Î“ÃªÃœ should initialize with SQLite when module loads successfully (75 ms)
      â”œÃ¹ should create ticket in SQLite mode (6 ms)
      â”œÃ¹ should retrieve all tickets from SQLite (12 ms)
    updateTicket
      â”œÃ¹ should update ticket in in-memory mode (150 ms)
      â”œÃ¹ should update ticket in SQLite mode (4 ms)
      Î“ÃªÃœ should return null for non-existent ticket (83 ms)
      Î“ÃªÃœ should emit change event on update (132 ms)
    Migration & Backward Compatibility
      â”œÃ¹ should migrate SQLite table without type column (1 ms)
      â”œÃ¹ should read old tickets without type field as undefined (10 ms)
    Integration: Full CRUD Flow
      â”œÃ¹ should complete full CRUD lifecycle: create Î“Ã¥Ã† read Î“Ã¥Ã† update Î“Ã¥Ã† read (375 ms)
      â”œÃ¹ should handle concurrent updates on same ticket (158 ms)
      Î“ÃªÃœ should gracefully fall back to in-memory when SQLite fails (15 ms)
    Error Handling
      â”œÃ¹ should handle createTicket error in SQLite mode (4 ms)
      â”œÃ¹ should handle getAllTickets error in SQLite mode (3 ms)
      â”œÃ¹ should handle getTicket error in SQLite mode (3 ms)
      â”œÃ¹ should warn when initialize is called twice (4 ms)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ SQLite Mode Operations Î“Ã‡â•‘ should create ticket in SQLite mode

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      399 |
      400 |             // Assert
    > 401 |             expect(mockRunSpy).toHaveBeenCalled();
          |                                ^
      402 |             expect(mockRunSpy.mock.calls.some((call: any[]) => call[0]?.includes('INSERT INTO'))).toBe(true);
      403 |             expect(ticket.title).toBe('SQLite Test');
      404 |         });

      at Object.<anonymous> (tests/ticketDb.test.ts:401:32)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ SQLite Mode Operations Î“Ã‡â•‘ should retrieve all tickets from SQLite

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      456 |
      457 |             // Assert
    > 458 |             expect(mockAllSpy).toHaveBeenCalled();
          |                                ^
      459 |             expect(tickets).toHaveLength(2);
      460 |             expect(tickets[0].title).toBe('First');
      461 |             expect(tickets[1].title).toBe('Second');

      at Object.<anonymous> (tests/ticketDb.test.ts:458:32)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ updateTicket Î“Ã‡â•‘ should update ticket in in-memory mode

    expect(received).toBe(expected) // Object.is equality

    Expected: "2026-02-05T04:19:43.248Z"
    Received: null

      505 |             expect(updated?.title).toBe('Updated Title');
      506 |             expect(updated?.status).toBe('done');
    > 507 |             expect(updated?.createdAt).toBe(created.createdAt); // createdAt unchanged
          |                                        ^
      508 |             expect(updated?.updatedAt).not.toBe(created.updatedAt); // updatedAt changed
      509 |         });
      510 |

      at Object.<anonymous> (tests/ticketDb.test.ts:507:40)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ updateTicket Î“Ã‡â•‘ should update ticket in SQLite mode

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      561 |
      562 |             // Assert: Verify db.run was called with UPDATE SQL
    > 563 |             expect(mockRunSpy).toHaveBeenCalled();
          |                                ^
      564 |             const updateCall = mockRunSpy.mock.calls.find((call: any[]) =>
      565 |                 typeof call[0] === 'string' && call[0].includes('UPDATE tickets')
      566 |             );

      at Object.<anonymous> (tests/ticketDb.test.ts:563:32)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Migration & Backward Compatibility Î“Ã‡â•‘ should migrate SQLite table without type column

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      664 |
      665 |             // Assert: Verify ALTER TABLE was called to add type column
    > 666 |             expect(mockRunSpy).toHaveBeenCalled();
          |                                ^
      667 |             const alterCall = mockRunSpy.mock.calls.find((call: any[]) =>
      668 |                 typeof call[0] === 'string' && call[0].includes('ALTER TABLE') && call[0].includes('ADD COLUMN type')
      669 |             );

      at Object.<anonymous> (tests/ticketDb.test.ts:666:32)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Migration & Backward Compatibility Î“Ã‡â•‘ should read old tickets without type field as undefined

    expect(received).not.toBeNull()

    Received: null

      723 |
      724 |             // Assert: Old ticket should have type: undefined (backward compatibility)
    > 725 |             expect(ticket).not.toBeNull();
          |                                ^
      726 |             expect(ticket?.id).toBe('OLD-001');
      727 |             expect(ticket?.title).toBe('Old Ticket');
      728 |             expect(ticket?.type).toBeUndefined(); // No type = undefined (not 'ai_to_human')

      at Object.<anonymous> (tests/ticketDb.test.ts:725:32)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Integration: Full CRUD Flow Î“Ã‡â•‘ should complete full CRUD lifecycle: create Î“Ã¥Ã† read Î“Ã¥Ã† update Î“Ã¥Ã† read

    expect(received).toBe(expected) // Object.is equality

    Expected: "2026-02-05T04:19:43.658Z"
    Received: null

      785 |             expect(updated?.title).toBe('Updated Integration Test');
      786 |             expect(updated?.status).toBe('done');
    > 787 |             expect(updated?.createdAt).toBe(created.createdAt); // Unchanged
          |                                        ^
      788 |             expect(updated?.updatedAt).not.toBe(created.updatedAt); // Changed
      789 |
      790 |             // Step 4: READ again (verify update persisted)

      at Object.<anonymous> (tests/ticketDb.test.ts:787:40)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Integration: Full CRUD Flow Î“Ã‡â•‘ should handle concurrent updates on same ticket

    expect(received).toBe(expected) // Object.is equality

    Expected: "Update 2"
    Received: "Concurrent Test"

      814 |             // Final state should be last update (Update 2) since in-memory is synchronous
      815 |             const final = await getConc(ticket.id);
    > 816 |             expect(final?.title).toBe('Update 2');
          |                                  ^
      817 |             expect(final?.status).toBe('done');
      818 |         });
      819 |

      at Object.<anonymous> (tests/ticketDb.test.ts:816:34)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Error Handling Î“Ã‡â•‘ should handle createTicket error in SQLite mode

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"conversationHistory": undefined, "createdAt": "2026-02-05T04:19:44.136Z", "description": undefined, "id": "TICKET-1770265184136", "status": "open", "thread": undefined, "title": "Test", "type": undefined, "updatedAt": "2026-02-05T04:19:44.136Z"}

      920 |
      921 |             // Act & Assert: createTicket should throw/reject due to DB error
    > 922 |             await expect(createErr({ title: 'Test', status: 'open' }))
          |                   ^
      923 |                 .rejects.toThrow();
      924 |         });
      925 |

      at expect (node_modules/expect/build/index.js:2116:15)
      at Object.<anonymous> (tests/ticketDb.test.ts:922:19)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Error Handling Î“Ã‡â•‘ should handle getAllTickets error in SQLite mode

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: [{"conversationHistory": undefined, "createdAt": "2026-02-05T04:19:44.130Z", "description": undefined, "id": "TICKET-1770265184130", "status": "open", "thread": undefined, "title": "Fallback Test", "type": undefined, "updatedAt": "2026-02-05T04:19:44.130Z"}, {"conversationHistory": undefined, "createdAt": "2026-02-05T04:19:44.136Z", "description": undefined, "id": "TICKET-1770265184136", "status": "open", "thread": undefined, "title": "Test", "type": undefined, "updatedAt": "2026-02-05T04:19:44.136Z"}]

      938 |
      939 |             // Act & Assert: listTickets should throw/reject due to DB error
    > 940 |             await expect(listErr()).rejects.toThrow();
          |                   ^
      941 |         });
      942 |
      943 |         it('should handle getTicket error in SQLite mode', async () => {

      at expect (node_modules/expect/build/index.js:2116:15)
      at Object.<anonymous> (tests/ticketDb.test.ts:940:19)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Error Handling Î“Ã‡â•‘ should handle getTicket error in SQLite mode

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: null

      955 |
      956 |             // Act & Assert: getTicket should throw/reject due to DB error
    > 957 |             await expect(getErr('TICKET-001')).rejects.toThrow();
          |                   ^
      958 |         });
      959 |
      960 |         it('should warn when initialize is called twice', async () => {

      at expect (node_modules/expect/build/index.js:2116:15)
      at Object.<anonymous> (tests/ticketDb.test.ts:957:19)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Error Handling Î“Ã‡â•‘ should warn when initialize is called twice

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      983 |
      984 |             // Assert: Warning should be logged
    > 985 |             expect(mockLogWarn).toHaveBeenCalled();
          |                                 ^
      986 |             const warnCalls = mockLogWarn.mock.calls.map((call: any[]) => call[0]);
      987 |             expect(warnCalls.some((msg: string) => msg.includes('already initialized'))).toBe(true);
      988 |         });

      at Object.<anonymous> (tests/ticketDb.test.ts:985:33)

PASS tests/conversationWebview.test.ts
  ConversationWebviewPanel
    createOrShow
      Î“ÃªÃœ should reveal an existing panel if it already exists (2 ms)
      Î“ÃªÃœ should create a new panel if none exists for the chatId (7 ms)
      Î“ÃªÃœ should handle undefined initialMessages gracefully (1 ms)
      Î“ÃªÃœ should throw an error if globalState update fails (19 ms)
      Î“ÃªÃœ should log info when a new panel is created (1 ms)
    disposeAll
      Î“ÃªÃœ should dispose all panels and clear the panels map (1 ms)
      Î“ÃªÃœ should handle empty panels map gracefully
      Î“ÃªÃœ should handle errors during panel disposal (8 ms)
    getOpenPanels
      Î“ÃªÃœ should return an empty array when no panels are open (1 ms)
      Î“ÃªÃœ should return all open panels (1 ms)
      Î“ÃªÃœ should handle concurrent modifications to the panels map
      Î“ÃªÃœ should return panels in insertion order
      Î“ÃªÃœ should not mutate the original panels map (1 ms)
    restoreLastActive
      Î“ÃªÃœ should return null if no lastActiveChatId is found
      Î“ÃªÃœ should return null and log a warning if getConversationHistory throws an error
      Î“ÃªÃœ should call createOrShow and return a ConversationWebviewPanel instance on success (1 ms)

PASS tests/agents/answerAgent.test.ts
  AnswerAgent
    createChatId
      Î“ÃªÃœ should generate unique chat IDs (2 ms)
      Î“ÃªÃœ should generate chat IDs with expected format
    AnswerAgent.ask() - Single Turn
      Î“ÃªÃœ should answer a question and return the response (3 ms)
      Î“ÃªÃœ should store question and answer in history after first ask (2 ms)
      Î“ÃªÃœ should persist conversation history after each ask (2 ms)
      Î“ÃªÃœ should generate new chatId if none provided (4 ms)
    AnswerAgent.ask() - Multi-Turn
      Î“ÃªÃœ should include previous Q&A in messages for follow-up (3 ms)
      Î“ÃªÃœ should maintain separate histories for different chatIds (1 ms)
      Î“ÃªÃœ should trim history to MAX_HISTORY_EXCHANGES when exceeded (2 ms)
      Î“ÃªÃœ should pass complete message history to LLM on each turn (1 ms)
    AnswerAgent.getHistory()
      Î“ÃªÃœ should return undefined for non-existent chatId (1 ms)
      Î“ÃªÃœ should return empty array equivalent (via getHistory) for new chatId (2 ms)
    AnswerAgent.getActiveConversations()
      Î“ÃªÃœ should return active conversation metadata (1 ms)
    AnswerAgent.clearHistory()
      Î“ÃªÃœ should remove history for specified chatId (2 ms)
      Î“ÃªÃœ should not affect other chatIds when clearing one (1 ms)
    AnswerAgent Error Handling
      Î“ÃªÃœ should handle LLM errors gracefully (35 ms)
      Î“ÃªÃœ should log error when LLM fails (1 ms)
    Message Format Validation
      Î“ÃªÃœ should send messages in correct OpenAI format (2 ms)
      Î“ÃªÃœ should always include system prompt as first message (1 ms)
    Edge Cases
      Î“ÃªÃœ should handle empty question string
      Î“ÃªÃœ should handle very long question text (1 ms)
      Î“ÃªÃœ should handle exactly MAX_HISTORY_EXCHANGES exchanges without trimming (1 ms)
    Auto-close inactive conversations
      Î“ÃªÃœ should close conversations inactive for >30 days (3 ms)
      Î“ÃªÃœ should NOT close conversations active within 30 days (2 ms)
      Î“ÃªÃœ should handle exactly 30 days (boundary condition) (1 ms)
      Î“ÃªÃœ should handle cleanup with no conversations (1 ms)
      Î“ÃªÃœ should handle multiple chats (old and new) (2 ms)
      Î“ÃªÃœ should handle cleanup errors gracefully (1 ms)
      Î“ÃªÃœ should update lastActivityAt on each ask (2 ms)
      Î“ÃªÃœ should log each deleted conversation with details (2 ms)
    Persistence
      Î“ÃªÃœ should serialize history into JSON strings (1 ms)
      Î“ÃªÃœ should deserialize history back into the Map (1 ms)
      Î“ÃªÃœ should support save/load cycle across instances (1 ms)
      Î“ÃªÃœ should restore context after reload simulation (1 ms)
      Î“ÃªÃœ should warn and skip invalid JSON entries (1 ms)
      Î“ÃªÃœ should truncate oversized histories and warn (8 ms)

PASS tests/mcpServer/tools/reportTaskDone.spec.ts
  reportTaskDone Tool
    Parameter Validation
      Î“ÃªÃœ Test 1: should reject non-object params (2 ms)
      Î“ÃªÃœ Test 2: should require taskId
      Î“ÃªÃœ Test 3: should require valid status
      Î“ÃªÃœ Test 4: should accept valid params (1 ms)
    Task Reporting
      Î“ÃªÃœ Test 5: should return error when task not found
      Î“ÃªÃœ Test 6: should update ticket to done
      Î“ÃªÃœ Test 7: should append notes to description (1 ms)
      Î“ÃªÃœ Test 8: should map failed to blocked
    Verification Trigger
      Î“ÃªÃœ Test 9: should trigger verification when done with codeDiff (1 ms)
      Î“ÃªÃœ Test 10: should mark blocked if verification fails
    Error Handling
      Î“ÃªÃœ Test 11: should return internal error on exception

PASS tests/integration.spec/logRegisteredTools.test.ts
  logRegisteredTools
    Î“ÃªÃœ should log the names of all registered tools (1 ms)

PASS tests/errors/errorHandling.spec.ts
  Error Handling
    Validation Errors
      Missing Parameter
        Î“ÃªÃœ Test 1: should create error with correct code and message (6 ms)
        Î“ÃªÃœ Test 2: should throw with formatted message (90 ms)
      Invalid Type
        Î“ÃªÃœ Test 3: should create error with type details (1 ms)
        Î“ÃªÃœ Test 4: should throw with type information (1 ms)
      Out of Range
        Î“ÃªÃœ Test 5: should create error with range details
        Î“ÃªÃœ Test 6: should throw with range information (1 ms)
      Invalid Enum
        Î“ÃªÃœ Test 7: should create error with allowed values (1 ms)
      Require Helpers
        Î“ÃªÃœ Test 8: requireParam should return value if present
        Î“ÃªÃœ Test 9: requireParam should throw for null/undefined (2 ms)
        Î“ÃªÃœ Test 10: requireNonEmptyString should reject empty strings (1 ms)
        Î“ÃªÃœ Test 11: requireInRange should validate numeric ranges (42 ms)
    Timeout and Rate Limit Errors
      Timeout
        Î“ÃªÃœ Test 12: should create timeout error with retry suggestion (1 ms)
        Î“ÃªÃœ Test 13: should cap retry delay at 5 minutes
        Î“ÃªÃœ Test 14: should throw with retry suggestion (3 ms)
      Rate Limit
        Î“ÃªÃœ Test 15: should create rate limit error with default wait
        Î“ÃªÃœ Test 16: should respect custom retry delay (1 ms)
      LLM-Specific Timeout
        Î“ÃªÃœ Test 17: should create LLM startup timeout with context
        Î“ÃªÃœ Test 18: should provide different suggestions for each phase (1 ms)
      Backoff Calculation
        Î“ÃªÃœ Test 19: should calculate exponential backoff correctly
        Î“ÃªÃœ Test 20: should cap at maximum delay (1 ms)
      Error Detection
        Î“ÃªÃœ Test 21: should detect timeout errors (1 ms)
        Î“ÃªÃœ Test 22: should detect rate limit errors (1 ms)
        Î“ÃªÃœ Test 23: should extract retry delay from error message
    State Conflict Errors
      Task In Progress
        Î“ÃªÃœ Test 24: should create task in progress error with steps (2 ms)
        Î“ÃªÃœ Test 25: should throw with task ID (4 ms)
      Invalid State Transition
        Î“ÃªÃœ Test 26: should create transition error with allowed states (1 ms)
        Î“ÃªÃœ Test 27: should list allowed transitions in resolution
      Resource Locked
        Î“ÃªÃœ Test 28: should create locked error with holder info
        Î“ÃªÃœ Test 29: should work without lock holder (1 ms)
      Ticket Conflict
        Î“ÃªÃœ Test 30: should create conflict error with version info
      Ticket State Machine
        Î“ÃªÃœ Test 31: should define valid transitions (1 ms)
        Î“ÃªÃœ Test 32: should validate allowed transitions (1 ms)
      Error Detection
        Î“ÃªÃœ Test 33: should detect state conflict errors
    Cross-Category
      Î“ÃªÃœ Test 34: all errors should have distinct error codes
      Î“ÃªÃœ Test 35: all errors should be instances of Error when thrown (2 ms)

PASS tests/config/schema.test.ts
  Config Schema Tests
    Schema Validation (Happy Path)
      Î“ÃªÃœ Test 1: should parse valid config with all fields (35 ms)
      Î“ÃªÃœ Test 2: should apply defaults for missing optional fields (1 ms)
      Î“ÃªÃœ Test 3: should use defaults for completely empty config object (2 ms)
    Schema Validation (Edge Cases)
      Î“ÃªÃœ Test 4: should reject invalid enum value for logLevel (44 ms)
      Î“ÃªÃœ Test 5: should reject negative timeoutSeconds (2 ms)
      Î“ÃªÃœ Test 6: should reject zero for positive-only fields (2 ms)
      Î“ÃªÃœ Test 7: should reject string for numeric field (1 ms)
      Î“ÃªÃœ Test 8: should reject tokenPollIntervalSeconds below min (10) (1 ms)
      Î“ÃªÃœ Test 9: should reject tokenPollIntervalSeconds above max (120) (1 ms)
      Î“ÃªÃœ Test 10: should reject invalid URL for endpoint (1 ms)
      Î“ÃªÃœ Test 11: should accept valid URL with custom IP (1 ms)
      Î“ÃªÃœ Test 12: should accept boolean true for auditLog.enabled (1 ms)
      Î“ÃªÃœ Test 13: should reject non-boolean for auditLog.enabled (1 ms)
      Î“ÃªÃœ Test 14: should handle deep partial config merge (1 ms)
      Î“ÃªÃœ Test 15: should accept min boundary for tokenPollIntervalSeconds (10) (1 ms)
      Î“ÃªÃœ Test 16: should accept max boundary for tokenPollIntervalSeconds (120) (3 ms)
    Config Immutability
      Î“ÃªÃœ Test 17: returned config should be readonly (TypeScript type level) (1 ms)
    DEFAULT_CONFIG constant
      Î“ÃªÃœ Test 18: DEFAULT_CONFIG should match schema defaults (1 ms)
      Î“ÃªÃœ Test 19: DEFAULT_CONFIG should have all required sections (1 ms)

PASS tests/config/loader.test.ts
  Config Loader Tests
    File I/O (Happy Path)
      Î“ÃªÃœ Test 1: should load valid config file successfully (5 ms)
      Î“ÃªÃœ Test 2: should handle missing config file gracefully (1 ms)
      Î“ÃªÃœ Test 3: should merge partial config with defaults (1 ms)
    File I/O (Error Handling)
      Î“ÃªÃœ Test 4: should handle malformed JSON gracefully (1 ms)
      Î“ÃªÃœ Test 5: should handle file read errors (1 ms)
      Î“ÃªÃœ Test 6: should handle validation error with partial valid data (12 ms)
    Config Access Patterns
      Î“ÃªÃœ Test 7: should return config with readonly typing (1 ms)
      Î“ÃªÃœ Test 8: should preserve offline LLM endpoint with custom IP (1 ms)
    Coverage for All Config Sections
      Î“ÃªÃœ Test 9: should validate and merge all config sections (2 ms)

PASS tests/mcpServer.test.ts (6.992 s)
  MCP Server
    Server Lifecycle
      Î“ÃªÃœ should start the server successfully (65 ms)
      Î“ÃªÃœ should stop the server successfully (1 ms)
      Î“ÃªÃœ should not start the server twice (1 ms)
    JSON-RPC Request Handling
      Î“ÃªÃœ should handle valid getNextTask request (121 ms)
      Î“ÃªÃœ should handle invalid JSON with parse error (85 ms)
      Î“ÃªÃœ should handle unknown method with method not found error (70 ms)
      Î“ÃªÃœ should handle invalid JSON-RPC version (71 ms)
      Î“ÃªÃœ should handle orchestrator error gracefully (59 ms)
    Edge Cases
      Î“ÃªÃœ should handle request without id (62 ms)
      Î“ÃªÃœ should handle empty response from orchestrator (63 ms)
    COE Agent Tool
      Î“ÃªÃœ should route "plan" command to planning agent (57 ms)
      Î“ÃªÃœ should route "verify" command and format result as PASS/FAIL (66 ms)
      Î“ÃªÃœ should format FAIL verification result correctly (63 ms)
      Î“ÃªÃœ should route "ask" command to answer agent (61 ms)
      Î“ÃªÃœ should return error for invalid command (83 ms)
      Î“ÃªÃœ should return error for missing task arg in plan command (66 ms)
      Î“ÃªÃœ should return error for missing code arg in verify command (105 ms)
      Î“ÃªÃœ should return error for missing question arg in ask command (116 ms)
      Î“ÃªÃœ should return error for missing args object (104 ms)
      Î“ÃªÃœ should handle orchestrator errors gracefully (124 ms)
      Î“ÃªÃœ should use default task description for verify when not provided (73 ms)

PASS tests/ui/llmStatusBar.test.ts
  LlmStatusBarManager
    Î“ÃªÃœ shows spinner on first start and hides after debounce (3 ms)
    Î“ÃªÃœ keeps spinner for concurrent calls (2 ms)
    Î“ÃªÃœ cancels pending hide when a new call starts (1 ms)

PASS tests/ui/agentsTreeProvider.test.ts
  AgentsTreeDataProvider (Dynamic Status)
    constructor
      Î“ÃªÃœ should subscribe to ticket changes on instantiation (1 ms)
      Î“ÃªÃœ should handle subscription errors gracefully (1 ms)
    getChildren with dynamic status
      Î“ÃªÃœ should return 6 items: 1 toggle + 5 agents (1 ms)
      Î“ÃªÃœ should display Manual mode toggle when autoProcessTickets is false (1 ms)
      Î“ÃªÃœ should display Auto mode toggle when autoProcessTickets is true
      Î“ÃªÃœ should set command on toggle item to trigger toggleAutoProcessing
      Î“ÃªÃœ should display Idle when status is undefined (1 ms)
      Î“ÃªÃœ should display Active status with truncated result (47 ms)
      Î“ÃªÃœ should use spinning icon for Active agent
      Î“ÃªÃœ should use check icon for Waiting agent (2 ms)
      Î“ÃªÃœ should use error icon for Failed agent (1 ms)
      Î“ÃªÃœ should include timestamp in tooltip (1 ms)
      Î“ÃªÃœ should handle result truncation to 50 chars
      Î“ÃªÃœ should display all agents with different statuses (1 ms)
      Î“ÃªÃœ should not include "Last:" in description when no result (1 ms)
      Î“ÃªÃœ should display currentTask in description when available (1 ms)
      Î“ÃªÃœ should prioritize currentTask over lastResult in description (10 ms)
      Î“ÃªÃœ should truncate currentTask to 50 chars
      Î“ÃªÃœ should include currentTask in tooltip (1 ms)
      Î“ÃªÃœ should include both currentTask and lastResult in tooltip (1 ms)
      Î“ÃªÃœ should show "Idle" with no extra info when agent has no task or result (1 ms)
      Î“ÃªÃœ should handle Failed agent with error message in tooltip (6 ms)
      Î“ÃªÃœ should display "Disabled" and gray icon for disabled agents (1 ms)
      Î“ÃªÃœ should set contextValue to coe-agent-enabled for enabled agents (1 ms)
      Î“ÃªÃœ should set contextValue to coe-agent-disabled for disabled agents (2 ms)
      Î“ÃªÃœ should include right-click hint in tooltip for enabled agents (1 ms)
      Î“ÃªÃœ should include right-click hint in tooltip for disabled agents (2 ms)
      Î“ÃªÃœ should check correct setting key for each agent (7 ms)
    tree refresh on ticket change
      Î“ÃªÃœ should trigger refresh when listener called (1 ms)
      Î“ÃªÃœ should fire onDidChangeTreeData when refresh called
    real-time updates on agent status change
      Î“ÃªÃœ should subscribe to agentStatusTracker.onStatusChange on construction
      Î“ÃªÃœ should refresh tree when agent status changes (1 ms)
    getTreeItem
      Î“ÃªÃœ should return item unchanged
    getChildren with element
      Î“ÃªÃœ should return empty array for no children (6 ms)
    edge cases and comprehensive coverage
      Î“ÃªÃœ should handle agent with no timestamp gracefully
      Î“ÃªÃœ should show all 4 agents with different icons simultaneously (1 ms)
      Î“ÃªÃœ should handle very long currentTask and lastResult both present (1 ms)
      Î“ÃªÃœ should handle status change subscription error gracefully
      Î“ÃªÃœ should format timestamp correctly in tooltip (1 ms)
      Î“ÃªÃœ should handle empty string currentTask (1 ms)
      Î“ÃªÃœ should handle empty string lastResult (1 ms)

PASS tests/ui/conversationsTreeProvider.test.ts
  ConversationsTreeDataProvider
    constructor
      Î“ÃªÃœ should subscribe to ticket changes on instantiation (8 ms)
      Î“ÃªÃœ should handle subscription errors gracefully (1 ms)
    getTreeItem
      Î“ÃªÃœ should return the element as-is (1 ms)
    getChildren
      Î“ÃªÃœ should return empty array when element is provided (flat list) (1 ms)
      Î“ÃªÃœ should return placeholder when no conversations exist (5 ms)
      Î“ÃªÃœ should create TreeItem for a valid conversation ticket (3 ms)
      Î“ÃªÃœ should skip tickets with invalid JSON and show placeholder (2 ms)
      Î“ÃªÃœ should fall back to message count when timestamps are missing (1 ms)
      Î“ÃªÃœ should ignore tickets with empty conversation arrays
      Î“ÃªÃœ should include answer_agent tickets even when type is set (1 ms)
      Î“ÃªÃœ should show empty answer_agent tickets as new chats (1 ms)
      Î“ÃªÃœ should skip unexpected conversation formats (1 ms)
      Î“ÃªÃœ should handle database errors gracefully (6 ms)
    auto-refresh on ticket changes
      Î“ÃªÃœ should refresh when ticket change event fires (1 ms)
    refresh
      Î“ÃªÃœ should fire onDidChangeTreeData event (1 ms)
      Î“ÃªÃœ should log info message when refreshing (1 ms)
    onDidChangeTreeData
      Î“ÃªÃœ should expose the event emitter (2 ms)
    contextValue and command integration
      Î“ÃªÃœ should set contextValue on all conversation items (10 ms)
      Î“ÃªÃœ should include command with chatId for context menu handlers (1 ms)

  console.log
    [INFO] 2026-02-05T04:19:45.352Z Test info message

      at logInfo (src/logger.ts:69:17)

  console.warn
    [WARN] 2026-02-05T04:19:45.423Z Test warning message

    [0m [90m 75 |[39m         [36mconst[39m line [33m=[39m [32m`[WARN] ${new Date().toISOString()} ${message}`[39m[33m;[39m
     [90m 76 |[39m         getOutputChannel()[33m.[39mappendLine(line)[33m;[39m
    [31m[1m>[22m[39m[90m 77 |[39m         console[33m.[39mwarn(line)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 78 |[39m     }
     [90m 79 |[39m }
     [90m 80 |[39m[0m

      at logWarn (src/logger.ts:77:17)
      at tests/logger.test.ts:118:16
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.<anonymous> (tests/logger.test.ts:119:14)

  console.error
    [ERROR] 2026-02-05T04:19:45.438Z Test error message

    [0m [90m 83 |[39m     [36mconst[39m line [33m=[39m [32m`[ERROR] ${new Date().toISOString()} ${msg}`[39m[33m;[39m
     [90m 84 |[39m     getOutputChannel()[33m.[39mappendLine(line)[33m;[39m
    [31m[1m>[22m[39m[90m 85 |[39m     console[33m.[39merror(line)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 86 |[39m }
     [90m 87 |[39m[0m

      at logError (src/logger.ts:85:13)
      at tests/logger.test.ts:130:17
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.<anonymous> (tests/logger.test.ts:131:14)

  console.error
    [ERROR] 2026-02-05T04:19:45.443Z Test error object

    [0m [90m 83 |[39m     [36mconst[39m line [33m=[39m [32m`[ERROR] ${new Date().toISOString()} ${msg}`[39m[33m;[39m
     [90m 84 |[39m     getOutputChannel()[33m.[39mappendLine(line)[33m;[39m
    [31m[1m>[22m[39m[90m 85 |[39m     console[33m.[39merror(line)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 86 |[39m }
     [90m 87 |[39m[0m

      at logError (src/logger.ts:85:13)
      at tests/logger.test.ts:142:17
      at Object.<anonymous> (node_modules/expect/build/index.js:1824:9)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:2235:93)
      at Object.<anonymous> (tests/logger.test.ts:143:14)

PASS tests/logger.test.ts
  Logger
    initializeLogger
      Î“ÃªÃœ should initialize without throwing errors when config file does not exist (2 ms)
      Î“ÃªÃœ should initialize with default log level when config file is missing (1 ms)
      Î“ÃªÃœ should read log level from config file when it exists (1 ms)
      Î“ÃªÃœ should handle invalid JSON in config file gracefully (1 ms)
    logInfo
      Î“ÃªÃœ should log info messages (70 ms)
    logWarn
      Î“ÃªÃœ should log warning messages (15 ms)
    logError
      Î“ÃªÃœ should log error messages as strings (5 ms)
      Î“ÃªÃœ should log Error objects (4 ms)

PASS tests/ui/agentStatusTracker.test.ts
  AgentStatusTracker
    Singleton Instance
      Î“ÃªÃœ should return same instance on multiple calls (2 ms)
      Î“ÃªÃœ should initialize all agents to Idle status (1 ms)
    setAgentStatus
      Î“ÃªÃœ should set agent status to Active with result (1 ms)
      Î“ÃªÃœ should set agent status without result (undefined) (7 ms)
      Î“ÃªÃœ should update existing agent status (1 ms)
      Î“ÃªÃœ should set agent to Failed status with error message (1 ms)
      Î“ÃªÃœ should log agent status update (2 ms)
      Î“ÃªÃœ should truncate result in logs to 50 chars (2 ms)
      Î“ÃªÃœ should not include result in log if undefined (7 ms)
      Î“ÃªÃœ should handle empty string result
      Î“ÃªÃœ should update timestamp on each call (26 ms)
    getAgentStatus
      Î“ÃªÃœ should return agent status when it exists
      Î“ÃªÃœ should return undefined for non-existent agent
      Î“ÃªÃœ should return Idle status initially for all agents
      Î“ÃªÃœ should return same reference after multiple gets (1 ms)
    resetAll
      Î“ÃªÃœ should reset all agents to Idle status (1 ms)
      Î“ÃªÃœ should clear lastResult on reset
      Î“ÃªÃœ should log reset action (1 ms)
      Î“ÃªÃœ should reset only to Idle, not remove agents
      Î“ÃªÃœ should handle reset when agents already Idle (1 ms)
      Î“ÃªÃœ should reset multiple times independently (1 ms)
    getAllStatuses
      Î“ÃªÃœ should return map of all agent statuses (1 ms)
      Î“ÃªÃœ should return copy of internal map (not reference) (1 ms)
      Î“ÃªÃœ should include all four agents with initial Idle status (1 ms)
      Î“ÃªÃœ should include updated statuses after set operations
      Î“ÃªÃœ should include timestamp in all statuses after setAgentStatus (1 ms)
      Î“ÃªÃœ should reflect state after resetAll
    Complex Workflows
      Î“ÃªÃœ should handle planning workflow: Idle Î“Ã¥Ã† Active Î“Ã¥Ã† Waiting (1 ms)
      Î“ÃªÃœ should handle verification workflow: Idle Î“Ã¥Ã† Active Î“Ã¥Ã† Waiting with result
      Î“ÃªÃœ should handle error workflow: Idle Î“Ã¥Ã† Active Î“Ã¥Ã† Failed (1 ms)
      Î“ÃªÃœ should track multiple agents independently (2 ms)
    Edge Cases
      Î“ÃªÃœ should handle very long result strings
      Î“ÃªÃœ should handle special characters in result
      Î“ÃªÃœ should handle all valid status types (1 ms)
      Î“ÃªÃœ should handle rapid status updates
      Î“ÃªÃœ should handle getting status for all agent names (1 ms)
    currentTask field
      Î“ÃªÃœ should set currentTask via setAgentTask (1 ms)
      Î“ÃªÃœ should preserve currentTask when setAgentStatus is called without clearing it
      Î“ÃªÃœ should clear currentTask when set to undefined (1 ms)
      Î“ÃªÃœ should update timestamp when setting currentTask (12 ms)
      Î“ÃªÃœ should log currentTask changes
      Î“ÃªÃœ should truncate currentTask in logs to 50 chars (2 ms)
      Î“ÃªÃœ should handle setting task for non-existent agent gracefully (1 ms)
      Î“ÃªÃœ should clear currentTask on resetAll (5 ms)
    event emission
      Î“ÃªÃœ should expose onStatusChange event emitter (5 ms)
      Î“ÃªÃœ should fire event when setAgentStatus is called (1 ms)
      Î“ÃªÃœ should fire event when setAgentTask is called (1 ms)
      Î“ÃªÃœ should fire events for each agent on resetAll (1 ms)
      Î“ÃªÃœ should allow multiple listeners to subscribe (1 ms)
      Î“ÃªÃœ should not notify disposed listeners (1 ms)

PASS tests/mcpServer/tools/getNextTask.spec.ts
  getNextTask Tool
    Parameter Validation
      Î“ÃªÃœ Test 1: should accept undefined parameters (2 ms)
      Î“ÃªÃœ Test 2: should accept null parameters (1 ms)
      Î“ÃªÃœ Test 3: should accept empty object (1 ms)
      Î“ÃªÃœ Test 4: should accept valid filter: ready (1 ms)
      Î“ÃªÃœ Test 5: should accept valid filter: blocked
      Î“ÃªÃœ Test 6: should accept valid filter: all (1 ms)
      Î“ÃªÃœ Test 7: should reject invalid filter
      Î“ÃªÃœ Test 8: should accept boolean includeContext (1 ms)
      Î“ÃªÃœ Test 9: should reject non-boolean includeContext
      Î“ÃªÃœ Test 10: should reject non-object parameters (1 ms)
    Task Retrieval
      Î“ÃªÃœ Test 11: should return task when queue has items (1 ms)
      Î“ÃªÃœ Test 12: should return null task when queue is empty
      Î“ÃªÃœ Test 13: should include full context by default (1 ms)
      Î“ÃªÃœ Test 14: should exclude context when includeContext is false (1 ms)
    Filter Handling
      Î“ÃªÃœ Test 15: should handle "ready" filter (default behavior) (1 ms)
      Î“ÃªÃœ Test 16: should return empty for "blocked" filter
      Î“ÃªÃœ Test 17: should reject invalid filter (1 ms)
    Error Handling
      Î“ÃªÃœ Test 18: should handle orchestrator not initialized error (1 ms)
      Î“ÃªÃœ Test 19: should handle generic orchestrator errors
      Î“ÃªÃœ Test 20: should handle non-Error exceptions
    Edge Cases
      Î“ÃªÃœ Test 21: should handle all blocked tasks scenario (1 ms)
      Î“ÃªÃœ Test 22: should work with default parameters (no params provided)
      Î“ÃªÃœ Test 23: should handle task with minimal fields

PASS tests/getErrors.spec/validateGetErrorsParams.test.ts
  validateGetErrorsParams
    Î“ÃªÃœ Test 1: should validate undefined params as valid (1 ms)
    Î“ÃªÃœ Test 2: should validate null params as valid (2 ms)
    Î“ÃªÃœ Test 3: should validate empty object as valid (9 ms)
    Î“ÃªÃœ Test 4: should validate object with properties as valid (1 ms)
    Î“ÃªÃœ Test 5: should reject non-object params (string)
    Î“ÃªÃœ Test 6: should reject non-object params (number) (1 ms)
    Î“ÃªÃœ Test 7: should reject non-object params (boolean) (1 ms)
    Î“ÃªÃœ Test 8: should reject non-object params (array)

PASS tests/errors/errorCodes.spec.ts
  ErrorCode Enum
    Î“ÃªÃœ Test 1: should define key error codes (1 ms)
    Î“ÃªÃœ Test 2: should include drift-related error codes (4 ms)
    Î“ÃªÃœ Test 3: should have unique values

PASS tests/mcpServer/jsonrpc.spec.ts
  JSON-RPC Helpers
    Î“ÃªÃœ Test 1: should parse a valid single request (2 ms)
    Î“ÃªÃœ Test 2: should return parse error on invalid JSON (1 ms)
    Î“ÃªÃœ Test 3: should reject invalid request objects
    Î“ÃªÃœ Test 4: should handle batch requests (1 ms)
    Î“ÃªÃœ Test 5: should report invalid request inside batch (1 ms)
    Î“ÃªÃœ Test 6: should reject empty batch
    Î“ÃªÃœ Test 7: should build error response

PASS tests/ui/orchestratorStatusTreeProvider.test.ts
  OrchestratorStatusTreeDataProvider
    Î“ÃªÃœ Test 1: should return three status items with correct labels (2 ms)
    Î“ÃªÃœ Test 2: should show Idle when no last picked task (1 ms)
    Î“ÃªÃœ Test 3: should refresh when queue change event fires (1 ms)
    Î“ÃªÃœ Test 4: should assign click command for details (1 ms)

PASS tests/answerAgent.spec/AnswerAgent.clearHistory.web.spec.ts
  AnswerAgent - clearHistory
    Î“ÃªÃœ should delete the conversation history for the given chatId and log the action (1 ms)
    Î“ÃªÃœ should not log anything if the chatId does not exist in the conversation history (1 ms)

PASS tests/integration.spec/initializeMCPServer.web.spec.ts
  MCP Tool Registration
    Î“ÃªÃœ Test 1: should register at least three MCP tools (2 ms)
    Î“ÃªÃœ Test 2: should include required tool names (1 ms)

PASS tests/integration.spec/getRegisteredTools.test.ts
  getRegisteredTools
    Î“ÃªÃœ should return a copy of the registered tools array (1 ms)
    Î“ÃªÃœ should not allow modifications to the original registered tools (1 ms)

PASS tests/example.test.ts
  Î“ÃªÃœ hello world! (1 ms)

PASS tests/getErrors.spec/handleGetErrors.test.ts
  handleGetErrors
    Î“ÃªÃœ Test 1: should return empty diagnostics when file does not exist (2 ms)
    Î“ÃªÃœ Test 2: should return diagnostics successfully when file exists with valid data (1 ms)
    Î“ÃªÃœ Test 3: should handle invalid JSON in diagnostics file (1 ms)
    Î“ÃªÃœ Test 4: should handle missing required fields in diagnostics file (6 ms)
    Î“ÃªÃœ Test 5: should handle file read errors (1 ms)
    Î“ÃªÃœ Test 6: should handle empty diagnostics file correctly (1 ms)
    Î“ÃªÃœ Test 7: should handle params being undefined (1 ms)
    Î“ÃªÃœ Test 8: should handle params being empty object (1 ms)

PASS tests/agents/researchAgent.test.ts
  ResearchAgent
    runResearch()
      Î“ÃªÃœ should generate a markdown report with query, timestamp, and content (43 ms)
      Î“ÃªÃœ should call completeLLM with correct system prompt and temperature (2 ms)
      Î“ÃªÃœ should simulate 10-minute delay before calling LLM (4 ms)
      Î“ÃªÃœ should handle LLM errors gracefully and return error MD report (5 ms)
      Î“ÃªÃœ should handle non-Error thrown values (3 ms)
      Î“ÃªÃœ should truncate long queries in logs to prevent overflow (3 ms)
      Î“ÃªÃœ should log completion with content length (3 ms)
      Î“ÃªÃœ should include helpful troubleshooting tips in error reports (2 ms)

PASS tests/config/index.test.ts
  Config Singleton Service Tests
    Initialization
      Î“ÃªÃœ Test 1: should initialize config on first call (6 ms)
      Î“ÃªÃœ Test 2: should prevent re-initialization (singleton contract) (16 ms)
      Î“ÃªÃœ Test 3: should propagate loader errors (5 ms)
    Access & Retrieval
      Î“ÃªÃœ Test 4: should throw if getConfigInstance called before init (3 ms)
      Î“ÃªÃœ Test 5: should return config instance after init (1 ms)
      Î“ÃªÃœ Test 6: should return same instance on multiple calls (singleton) (1 ms)
    Test Reset for Isolation
      Î“ÃªÃœ Test 7: should allow re-initialization after reset (2 ms)

PASS tests/llmService.test.ts (11.767 s)
  LLM Service
    initializeLLMService
      Î“ÃªÃœ should throw error if fetch is not available (Node <18) (66 ms)
      Î“ÃªÃœ should use config from centralized config system (2 ms)
      Î“ÃªÃœ should read LLM config from centralized config system (1 ms)
      Î“ÃªÃœ should use validated config values from centralized config (validation handled by Zod) (1 ms)
      Î“ÃªÃœ should use maxTokens from centralized config (validation handled by Zod) (1 ms)
      Î“ÃªÃœ should initialize successfully with centralized config (1 ms)
    completeLLM
      Î“ÃªÃœ should make successful LLM request (3 ms)
      Î“ÃªÃœ should include system prompt if provided (3 ms)
      Î“ÃªÃœ should handle network errors and create blocked ticket (3 ms)
      Î“ÃªÃœ should handle HTTP error responses (1 ms)
      Î“ÃªÃœ should handle timeout with AbortError (1 ms)
      Î“ÃªÃœ should handle ECONNREFUSED error specifically (1 ms)
    streamLLM
      Î“ÃªÃœ should stream chunks and accumulate response (3 ms)
      Î“ÃªÃœ should skip malformed SSE lines gracefully (11 ms)
      Î“ÃªÃœ should abort on inactivity timeout (2092 ms)
      Î“ÃªÃœ should handle streaming network errors (2 ms)
      Î“ÃªÃœ should handle HTTP error in streaming (1 ms)
      Î“ÃªÃœ should abort on startup timeout (595 ms)
      Î“ÃªÃœ should abort on inactivity timeout after first chunk (2140 ms)
      Î“ÃªÃœ should not double-abort if startup and inactivity timeouts overlap (2074 ms)
    token management
      token estimation
        Î“ÃªÃœ should estimate tokens for empty string as 0
        Î“ÃªÃœ should estimate tokens with reasonable accuracy (1 ms)
        Î“ÃªÃœ should estimate longer text with â”¬â–’20% variance tolerance
      message trimming
        Î“ÃªÃœ should not trim messages under 80% of maxTokens (1 ms)
        Î“ÃªÃœ should trim oldest messages when over 80% of maxTokens (1 ms)
        Î“ÃªÃœ should preserve system message even if it exceeds limit
        Î“ÃªÃœ should keep system message + last 3 exchanges minimum (1 ms)
      integration with completeLLM
        Î“ÃªÃœ should apply trimming before calling LLM (1 ms)
        Î“ÃªÃœ should work with legacy mode (prompt + systemPrompt)
      integration with streamLLM
        Î“ÃªÃœ should apply trimming before streaming (1 ms)

Summary of all failing tests
FAIL tests/cache/cacheManagement.spec.ts (5.394 s)
  Î“Ã¹Ã… Cache Management Î“Ã‡â•‘ Index - MT-004.3 Î“Ã‡â•‘ Test 14: should calculate cache statistics

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: undefined

      315 |
      316 |             const stats = getCacheStats(mockContext);
    > 317 |             expect(stats.totalItems).toBe(0); // Not added to index yet
          |                                      ^
      318 |         });
      319 |     });
      320 |

      at Object.<anonymous> (tests/cache/cacheManagement.spec.ts:317:38)

  Î“Ã¹Ã… Cache Management Î“Ã‡â•‘ Pruning - MT-004.5 Î“Ã‡â•‘ Test 21: should get cache size info

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: undefined

      391 |         it('Test 21: should get cache size info', () => {
      392 |             const info = getCacheSizeInfo(mockContext);
    > 393 |             expect(info.totalBytes).toBe(0);
          |                                     ^
      394 |             expect(info.itemCount).toBe(0);
      395 |         });
      396 |     });

      at Object.<anonymous> (tests/cache/cacheManagement.spec.ts:393:37)

FAIL tests/ticketDb.test.ts (6.379 s)
  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ SQLite Mode Operations Î“Ã‡â•‘ should create ticket in SQLite mode

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      399 |
      400 |             // Assert
    > 401 |             expect(mockRunSpy).toHaveBeenCalled();
          |                                ^
      402 |             expect(mockRunSpy.mock.calls.some((call: any[]) => call[0]?.includes('INSERT INTO'))).toBe(true);
      403 |             expect(ticket.title).toBe('SQLite Test');
      404 |         });

      at Object.<anonymous> (tests/ticketDb.test.ts:401:32)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ SQLite Mode Operations Î“Ã‡â•‘ should retrieve all tickets from SQLite

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      456 |
      457 |             // Assert
    > 458 |             expect(mockAllSpy).toHaveBeenCalled();
          |                                ^
      459 |             expect(tickets).toHaveLength(2);
      460 |             expect(tickets[0].title).toBe('First');
      461 |             expect(tickets[1].title).toBe('Second');

      at Object.<anonymous> (tests/ticketDb.test.ts:458:32)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ updateTicket Î“Ã‡â•‘ should update ticket in in-memory mode

    expect(received).toBe(expected) // Object.is equality

    Expected: "2026-02-05T04:19:43.248Z"
    Received: null

      505 |             expect(updated?.title).toBe('Updated Title');
      506 |             expect(updated?.status).toBe('done');
    > 507 |             expect(updated?.createdAt).toBe(created.createdAt); // createdAt unchanged
          |                                        ^
      508 |             expect(updated?.updatedAt).not.toBe(created.updatedAt); // updatedAt changed
      509 |         });
      510 |

      at Object.<anonymous> (tests/ticketDb.test.ts:507:40)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ updateTicket Î“Ã‡â•‘ should update ticket in SQLite mode

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      561 |
      562 |             // Assert: Verify db.run was called with UPDATE SQL
    > 563 |             expect(mockRunSpy).toHaveBeenCalled();
          |                                ^
      564 |             const updateCall = mockRunSpy.mock.calls.find((call: any[]) =>
      565 |                 typeof call[0] === 'string' && call[0].includes('UPDATE tickets')
      566 |             );

      at Object.<anonymous> (tests/ticketDb.test.ts:563:32)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Migration & Backward Compatibility Î“Ã‡â•‘ should migrate SQLite table without type column

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      664 |
      665 |             // Assert: Verify ALTER TABLE was called to add type column
    > 666 |             expect(mockRunSpy).toHaveBeenCalled();
          |                                ^
      667 |             const alterCall = mockRunSpy.mock.calls.find((call: any[]) =>
      668 |                 typeof call[0] === 'string' && call[0].includes('ALTER TABLE') && call[0].includes('ADD COLUMN type')
      669 |             );

      at Object.<anonymous> (tests/ticketDb.test.ts:666:32)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Migration & Backward Compatibility Î“Ã‡â•‘ should read old tickets without type field as undefined

    expect(received).not.toBeNull()

    Received: null

      723 |
      724 |             // Assert: Old ticket should have type: undefined (backward compatibility)
    > 725 |             expect(ticket).not.toBeNull();
          |                                ^
      726 |             expect(ticket?.id).toBe('OLD-001');
      727 |             expect(ticket?.title).toBe('Old Ticket');
      728 |             expect(ticket?.type).toBeUndefined(); // No type = undefined (not 'ai_to_human')

      at Object.<anonymous> (tests/ticketDb.test.ts:725:32)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Integration: Full CRUD Flow Î“Ã‡â•‘ should complete full CRUD lifecycle: create Î“Ã¥Ã† read Î“Ã¥Ã† update Î“Ã¥Ã† read

    expect(received).toBe(expected) // Object.is equality

    Expected: "2026-02-05T04:19:43.658Z"
    Received: null

      785 |             expect(updated?.title).toBe('Updated Integration Test');
      786 |             expect(updated?.status).toBe('done');
    > 787 |             expect(updated?.createdAt).toBe(created.createdAt); // Unchanged
          |                                        ^
      788 |             expect(updated?.updatedAt).not.toBe(created.updatedAt); // Changed
      789 |
      790 |             // Step 4: READ again (verify update persisted)

      at Object.<anonymous> (tests/ticketDb.test.ts:787:40)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Integration: Full CRUD Flow Î“Ã‡â•‘ should handle concurrent updates on same ticket

    expect(received).toBe(expected) // Object.is equality

    Expected: "Update 2"
    Received: "Concurrent Test"

      814 |             // Final state should be last update (Update 2) since in-memory is synchronous
      815 |             const final = await getConc(ticket.id);
    > 816 |             expect(final?.title).toBe('Update 2');
          |                                  ^
      817 |             expect(final?.status).toBe('done');
      818 |         });
      819 |

      at Object.<anonymous> (tests/ticketDb.test.ts:816:34)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Error Handling Î“Ã‡â•‘ should handle createTicket error in SQLite mode

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"conversationHistory": undefined, "createdAt": "2026-02-05T04:19:44.136Z", "description": undefined, "id": "TICKET-1770265184136", "status": "open", "thread": undefined, "title": "Test", "type": undefined, "updatedAt": "2026-02-05T04:19:44.136Z"}

      920 |
      921 |             // Act & Assert: createTicket should throw/reject due to DB error
    > 922 |             await expect(createErr({ title: 'Test', status: 'open' }))
          |                   ^
      923 |                 .rejects.toThrow();
      924 |         });
      925 |

      at expect (node_modules/expect/build/index.js:2116:15)
      at Object.<anonymous> (tests/ticketDb.test.ts:922:19)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Error Handling Î“Ã‡â•‘ should handle getAllTickets error in SQLite mode

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: [{"conversationHistory": undefined, "createdAt": "2026-02-05T04:19:44.130Z", "description": undefined, "id": "TICKET-1770265184130", "status": "open", "thread": undefined, "title": "Fallback Test", "type": undefined, "updatedAt": "2026-02-05T04:19:44.130Z"}, {"conversationHistory": undefined, "createdAt": "2026-02-05T04:19:44.136Z", "description": undefined, "id": "TICKET-1770265184136", "status": "open", "thread": undefined, "title": "Test", "type": undefined, "updatedAt": "2026-02-05T04:19:44.136Z"}]

      938 |
      939 |             // Act & Assert: listTickets should throw/reject due to DB error
    > 940 |             await expect(listErr()).rejects.toThrow();
          |                   ^
      941 |         });
      942 |
      943 |         it('should handle getTicket error in SQLite mode', async () => {

      at expect (node_modules/expect/build/index.js:2116:15)
      at Object.<anonymous> (tests/ticketDb.test.ts:940:19)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Error Handling Î“Ã‡â•‘ should handle getTicket error in SQLite mode

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: null

      955 |
      956 |             // Act & Assert: getTicket should throw/reject due to DB error
    > 957 |             await expect(getErr('TICKET-001')).rejects.toThrow();
          |                   ^
      958 |         });
      959 |
      960 |         it('should warn when initialize is called twice', async () => {

      at expect (node_modules/expect/build/index.js:2116:15)
      at Object.<anonymous> (tests/ticketDb.test.ts:957:19)

  Î“Ã¹Ã… TicketDb Î“Ã‡â•‘ Error Handling Î“Ã‡â•‘ should warn when initialize is called twice

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      983 |
      984 |             // Assert: Warning should be logged
    > 985 |             expect(mockLogWarn).toHaveBeenCalled();
          |                                 ^
      986 |             const warnCalls = mockLogWarn.mock.calls.map((call: any[]) => call[0]);
      987 |             expect(warnCalls.some((msg: string) => msg.includes('already initialized'))).toBe(true);
      988 |         });

      at Object.<anonymous> (tests/ticketDb.test.ts:985:33)


Test Suites: 2 failed, 31 passed, 33 total
Tests:       14 failed, 582 passed, 596 total
Snapshots:   0 total
Time:        13.024 s, estimated 18 s
Ran all test suites.
